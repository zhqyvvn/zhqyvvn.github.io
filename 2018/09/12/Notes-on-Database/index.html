<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhqyvvn.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":true,"transition":{"menu_item":"flipInX","post_block":"none","post_header":"flipInX","post_body":"none","coll_header":"flipInX","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Reading notes of Database Systems-The Complete Book(2nd edition) The Relational Model of Data Relational Algebra: This algebra underlies most query languages for the relational model. Its principal op">
<meta property="og:type" content="article">
<meta property="og:title" content="Reading notes of Database Systems">
<meta property="og:url" content="http://zhqyvvn.github.io/2018/09/12/Notes-on-Database/index.html">
<meta property="og:site_name" content="Tech Knowledge Sharing">
<meta property="og:description" content="Reading notes of Database Systems-The Complete Book(2nd edition) The Relational Model of Data Relational Algebra: This algebra underlies most query languages for the relational model. Its principal op">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-09-12T18:12:46.000Z">
<meta property="article:modified_time" content="2023-01-27T23:30:29.903Z">
<meta property="article:author" content="zhqyvvn">
<meta property="article:tag" content="Relational Algebra">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://zhqyvvn.github.io/2018/09/12/Notes-on-Database/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://zhqyvvn.github.io/2018/09/12/Notes-on-Database/","path":"2018/09/12/Notes-on-Database/","title":"Reading notes of Database Systems"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Reading notes of Database Systems | Tech Knowledge Sharing</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162128119-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-162128119-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tech Knowledge Sharing</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Relational-Model-of-Data"><span class="nav-number">1.</span> <span class="nav-text">The Relational Model of Data</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Basics-of-the-Relational-Model"><span class="nav-number">1.1.</span> <span class="nav-text">Basics of the Relational Model</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Defining-a-Relation-Schema-in-SQL"><span class="nav-number">1.2.</span> <span class="nav-text">Defining a Relation Schema in SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Data-Types"><span class="nav-number">1.2.1.</span> <span class="nav-text">Data Types</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Simple-Table-Declarations"><span class="nav-number">1.2.2.</span> <span class="nav-text">Simple Table Declarations</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Modifying-Relation-Schemas"><span class="nav-number">1.2.3.</span> <span class="nav-text">Modifying Relation Schemas</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Default-Values"><span class="nav-number">1.2.4.</span> <span class="nav-text">Default Values</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Declaring-Keys"><span class="nav-number">1.2.5.</span> <span class="nav-text">Declaring Keys</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#An-Algebraic-Query-Language"><span class="nav-number">1.3.</span> <span class="nav-text">An Algebraic Query Language</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Set-Operations-on-Relations"><span class="nav-number">1.3.1.</span> <span class="nav-text">Set Operations on Relations</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Projection"><span class="nav-number">1.3.2.</span> <span class="nav-text">Projection</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Selection"><span class="nav-number">1.3.3.</span> <span class="nav-text">Selection</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cartesian-Product"><span class="nav-number">1.3.4.</span> <span class="nav-text">Cartesian Product</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Natural-Joins"><span class="nav-number">1.3.5.</span> <span class="nav-text">Natural Joins</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Theta-Joins"><span class="nav-number">1.3.6.</span> <span class="nav-text">Theta-Joins</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Combining-Operations-to-Form-Queries"><span class="nav-number">1.3.7.</span> <span class="nav-text">Combining Operations to Form Queries</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Naming-and-Renaming"><span class="nav-number">1.3.8.</span> <span class="nav-text">Naming and Renaming</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Relationships-Among-Operations"><span class="nav-number">1.3.9.</span> <span class="nav-text">Relationships Among Operations</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#A-Linear-Notation-for-Algebraic-Expressions"><span class="nav-number">1.3.10.</span> <span class="nav-text">A Linear Notation for Algebraic Expressions</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Constraints-on-Relations"><span class="nav-number">1.4.</span> <span class="nav-text">Constraints on Relations</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Design-Theory-for-Relational-Databases"><span class="nav-number">2.</span> <span class="nav-text">Design Theory for Relational Databases</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Functional-Dependencies"><span class="nav-number">2.1.</span> <span class="nav-text">Functional Dependencies</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Definition-of-Functional-Dependency"><span class="nav-number">2.1.1.</span> <span class="nav-text">Definition of Functional Dependency</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Keys-of-Relations"><span class="nav-number">2.1.2.</span> <span class="nav-text">Keys of Relations</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SuperKeys"><span class="nav-number">2.1.3.</span> <span class="nav-text">SuperKeys</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Rules-About-Functional-Dependencies"><span class="nav-number">2.2.</span> <span class="nav-text">Rules About Functional Dependencies</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#The-Splitting-x2F-Combining-Rule"><span class="nav-number">2.2.1.</span> <span class="nav-text">The Splitting&#x2F;Combining Rule</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Trivial-Functional-Dependencies"><span class="nav-number">2.2.2.</span> <span class="nav-text">Trivial Functional Dependencies</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Computing-the-Closure-of-Attributes"><span class="nav-number">2.2.3.</span> <span class="nav-text">Computing the Closure of Attributes</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#The-Transitive-Rule"><span class="nav-number">2.2.4.</span> <span class="nav-text">The Transitive Rule</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Closing-Sets-of-Functional-Dependencies"><span class="nav-number">2.2.5.</span> <span class="nav-text">Closing Sets of Functional Dependencies</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Projecting-Functional-Dependencies"><span class="nav-number">2.2.6.</span> <span class="nav-text">Projecting Functional Dependencies</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Design-of-Relational-Database-Schemas"><span class="nav-number">2.3.</span> <span class="nav-text">Design of Relational Database Schemas</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Anomalies"><span class="nav-number">2.3.1.</span> <span class="nav-text">Anomalies</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Decomposing-Relations"><span class="nav-number">2.3.2.</span> <span class="nav-text">Decomposing Relations</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Boyce-Codd-Normal-Form"><span class="nav-number">2.3.3.</span> <span class="nav-text">Boyce-Codd Normal Form</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Decomposition-into-BCNF"><span class="nav-number">2.3.4.</span> <span class="nav-text">Decomposition into BCNF</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#High-Level-Database-Models"><span class="nav-number">3.</span> <span class="nav-text">High-Level Database Models</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Algebraic-and-Logical-Query-Languages"><span class="nav-number">4.</span> <span class="nav-text">Algebraic and Logical Query Languages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Database-Language-SQL"><span class="nav-number">5.</span> <span class="nav-text">The Database Language SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Simple-Queries-in-SQL"><span class="nav-number">5.1.</span> <span class="nav-text">Simple Queries in SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Projection-in-SQL"><span class="nav-number">5.1.1.</span> <span class="nav-text">Projection in SQL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Selection-in-SQL"><span class="nav-number">5.1.2.</span> <span class="nav-text">Selection in SQL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Comparison-of-Strings"><span class="nav-number">5.1.3.</span> <span class="nav-text">Comparison of Strings</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pattern-Matching-in-SQL"><span class="nav-number">5.1.4.</span> <span class="nav-text">Pattern Matching in SQL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dates-and-Times"><span class="nav-number">5.1.5.</span> <span class="nav-text">Dates and Times</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Null-Values-and-Comparisons-Involving-NULL"><span class="nav-number">5.1.6.</span> <span class="nav-text">Null Values and Comparisons Involving NULL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#The-Truth-Value-UNKNOWN"><span class="nav-number">5.1.7.</span> <span class="nav-text">The Truth-Value UNKNOWN</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Ordering-the-Output"><span class="nav-number">5.1.8.</span> <span class="nav-text">Ordering the Output</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Queries-Involving-More-Than-One-Relation"><span class="nav-number">5.2.</span> <span class="nav-text">Queries Involving More Than One Relation</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Products-and-Joins-in-SQL"><span class="nav-number">5.2.1.</span> <span class="nav-text">Products and Joins in SQL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Disambiguating-Attributes"><span class="nav-number">5.2.2.</span> <span class="nav-text">Disambiguating Attributes</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Tuple-Variables"><span class="nav-number">5.2.3.</span> <span class="nav-text">Tuple Variables</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Interpreting-Multirelation-Queries"><span class="nav-number">5.2.4.</span> <span class="nav-text">Interpreting Multirelation Queries</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Union-Intersection-and-Difference-of-Queries"><span class="nav-number">5.2.5.</span> <span class="nav-text">Union, Intersection, and Difference of Queries</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Subqueries"><span class="nav-number">5.3.</span> <span class="nav-text">Subqueries</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Subqueries-that-Produce-Scalar-Values"><span class="nav-number">5.3.1.</span> <span class="nav-text">Subqueries that Produce Scalar Values</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Conditions-Involving-Relations"><span class="nav-number">5.3.2.</span> <span class="nav-text">Conditions Involving Relations</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Conditions-Involving-Tuples"><span class="nav-number">5.3.3.</span> <span class="nav-text">Conditions Involving Tuples</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Correlated-Subqueries"><span class="nav-number">5.3.4.</span> <span class="nav-text">Correlated Subqueries</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Subqueries-in-FROM-Clauses"><span class="nav-number">5.3.5.</span> <span class="nav-text">Subqueries in FROM Clauses</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SQL-Join-Expressions"><span class="nav-number">5.3.6.</span> <span class="nav-text">SQL Join Expressions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Natural-Joins-1"><span class="nav-number">5.3.7.</span> <span class="nav-text">Natural Joins</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Outerjoins"><span class="nav-number">5.3.8.</span> <span class="nav-text">Outerjoins</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Full-Relation-Operations"><span class="nav-number">5.4.</span> <span class="nav-text">Full-Relation Operations</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Eliminating-Duplicates"><span class="nav-number">5.4.1.</span> <span class="nav-text">Eliminating Duplicates</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Duplicates-in-Unions-Intersections-and-Differences"><span class="nav-number">5.4.2.</span> <span class="nav-text">Duplicates in Unions, Intersections, and Differences</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Grouping-and-Aggregation-in-SQL"><span class="nav-number">5.4.3.</span> <span class="nav-text">Grouping and Aggregation in SQL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Aggregation-Operators"><span class="nav-number">5.4.4.</span> <span class="nav-text">Aggregation Operators</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Grouping"><span class="nav-number">5.4.5.</span> <span class="nav-text">Grouping</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Grouping-Aggregation-and-Nulls"><span class="nav-number">5.4.6.</span> <span class="nav-text">Grouping, Aggregation, and Nulls</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#HAVING-Clauses"><span class="nav-number">5.4.7.</span> <span class="nav-text">HAVING Clauses</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Database-Modifications"><span class="nav-number">5.5.</span> <span class="nav-text">Database Modifications</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Insertion"><span class="nav-number">5.5.1.</span> <span class="nav-text">Insertion</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Deletion"><span class="nav-number">5.5.2.</span> <span class="nav-text">Deletion</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Updates"><span class="nav-number">5.5.3.</span> <span class="nav-text">Updates</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Transactions-in-SQL"><span class="nav-number">5.6.</span> <span class="nav-text">Transactions in SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Serializability"><span class="nav-number">5.6.1.</span> <span class="nav-text">Serializability</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Atomicity"><span class="nav-number">5.6.2.</span> <span class="nav-text">Atomicity</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Transactions"><span class="nav-number">5.6.3.</span> <span class="nav-text">Transactions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Read-Only-Transactionss"><span class="nav-number">5.6.4.</span> <span class="nav-text">Read-Only Transactionss</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dirty-Reads"><span class="nav-number">5.6.5.</span> <span class="nav-text">Dirty Reads</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Other-Isolation-Levels"><span class="nav-number">5.6.6.</span> <span class="nav-text">Other Isolation Levels</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Constraints-and-Triggers"><span class="nav-number">6.</span> <span class="nav-text">Constraints and Triggers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Keys-and-Foreign-Key"><span class="nav-number">6.1.</span> <span class="nav-text">Keys and Foreign Key</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Declaring-Foreign-Key-Constraints"><span class="nav-number">6.1.1.</span> <span class="nav-text">Declaring Foreign-Key Constraints</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Maintaining-Referential-Integrity"><span class="nav-number">6.1.2.</span> <span class="nav-text">Maintaining Referential Integrity</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Deferred-Checking-of-Constraints"><span class="nav-number">6.1.3.</span> <span class="nav-text">Deferred Checking of Constraints</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Constraints-on-Attributes-and-Tuples"><span class="nav-number">6.2.</span> <span class="nav-text">Constraints on Attributes and Tuples</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Not-Null-Constraints"><span class="nav-number">6.2.1.</span> <span class="nav-text">Not-Null Constraints</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Attribute-Based-CHECK-Constraints"><span class="nav-number">6.2.2.</span> <span class="nav-text">Attribute-Based CHECK Constraints</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Tuple-Based-CHECK-Constraints"><span class="nav-number">6.2.3.</span> <span class="nav-text">Tuple-Based CHECK Constraints</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Comparison-of-Tuple-and-Attribute-Based-Constraints"><span class="nav-number">6.2.4.</span> <span class="nav-text">Comparison of Tuple- and Attribute-Based Constraints</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Modification-of-Constraints"><span class="nav-number">6.3.</span> <span class="nav-text">Modification of Constraints</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Giving-Names-to-Constraints"><span class="nav-number">6.3.1.</span> <span class="nav-text">Giving Names to Constraints</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Altering-Constraints-on-Tables"><span class="nav-number">6.3.2.</span> <span class="nav-text">Altering Constraints on Tables</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Assertions"><span class="nav-number">6.4.</span> <span class="nav-text">Assertions</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Creating-Assertions"><span class="nav-number">6.4.1.</span> <span class="nav-text">Creating Assertions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-Assertions"><span class="nav-number">6.4.2.</span> <span class="nav-text">Using Assertions</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Triggers"><span class="nav-number">6.5.</span> <span class="nav-text">Triggers</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Triggers-in-SQL"><span class="nav-number">6.5.1.</span> <span class="nav-text">Triggers in SQL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#The-Options-for-Trigger-Design"><span class="nav-number">6.5.2.</span> <span class="nav-text">The Options for Trigger Design</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Views-and-Indexes"><span class="nav-number">7.</span> <span class="nav-text">Views and Indexes</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Virtual-Views"><span class="nav-number">7.1.</span> <span class="nav-text">Virtual Views</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Declaring-Views"><span class="nav-number">7.1.1.</span> <span class="nav-text">Declaring Views</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Querying-Views"><span class="nav-number">7.1.2.</span> <span class="nav-text">Querying Views</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Renaming-Attributes"><span class="nav-number">7.1.3.</span> <span class="nav-text">Renaming Attributes</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Modifying-Views"><span class="nav-number">7.2.</span> <span class="nav-text">Modifying Views</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#View-Removal"><span class="nav-number">7.2.1.</span> <span class="nav-text">View Removal</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Updatable-Views"><span class="nav-number">7.2.2.</span> <span class="nav-text">Updatable Views</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Instead-Of-Triggers-on-Views"><span class="nav-number">7.2.3.</span> <span class="nav-text">Instead-Of Triggers on Views</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Indexes-in-SQL"><span class="nav-number">7.3.</span> <span class="nav-text">Indexes in SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Selection-of-Indexes"><span class="nav-number">7.4.</span> <span class="nav-text">Selection of Indexes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Materialized-Views"><span class="nav-number">7.5.</span> <span class="nav-text">Materialized Views</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Index-Structures"><span class="nav-number">8.</span> <span class="nav-text">Index Structures</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Parallel-and-Distributed-Databases"><span class="nav-number">9.</span> <span class="nav-text">Parallel and Distributed Databases</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference"><span class="nav-number">10.</span> <span class="nav-text">Reference</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhqyvvn"
      src="https://avatars0.githubusercontent.com/u/38484412?s=460&v=4">
  <p class="site-author-name" itemprop="name">zhqyvvn</p>
  <div class="site-description" itemprop="description">I'm a Java developer wearing glasses ...coz I don't C#</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zhqyvvn" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhqyvvn" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhqyvvn@gmail.com" title="E-Mail → mailto:zhqyvvn@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://zhqyvvn.github.io/2018/09/12/Notes-on-Database/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/38484412?s=460&v=4">
      <meta itemprop="name" content="zhqyvvn">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Knowledge Sharing">
      <meta itemprop="description" content="I'm a Java developer wearing glasses ...coz I don't C#">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Reading notes of Database Systems | Tech Knowledge Sharing">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Reading notes of Database Systems
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-09-12 14:12:46" itemprop="dateCreated datePublished" datetime="2018-09-12T14:12:46-04:00">2018-09-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-01-27 18:30:29" itemprop="dateModified" datetime="2023-01-27T18:30:29-05:00">2023-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Notes/" itemprop="url" rel="index"><span itemprop="name">Notes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Reading notes of <em>Database Systems-The Complete Book(2nd edition)</em></p>
<h3 id="The-Relational-Model-of-Data"><a href="#The-Relational-Model-of-Data" class="headerlink" title="The Relational Model of Data"></a>The Relational Model of Data</h3><blockquote>
<p><em>Relational Algebra</em>: This algebra underlies most query languages for the relational model. Its principal operators are union, intersection, difference, selection, projection, Cartesian product, natural join, theta-join, and renaming.</p>
</blockquote>
<span id="more"></span>
<h4 id="Basics-of-the-Relational-Model"><a href="#Basics-of-the-Relational-Model" class="headerlink" title="Basics of the Relational Model"></a>Basics of the Relational Model</h4><table>
<thead>
<tr>
<th>title</th>
<th>year</th>
<th>length</th>
<th>genre</th>
</tr>
</thead>
<tbody><tr>
<td>Gone With the Wind</td>
<td>1939</td>
<td>231</td>
<td>drama</td>
</tr>
<tr>
<td>Star Wars</td>
<td>1997</td>
<td>124</td>
<td>sciFi</td>
</tr>
<tr>
<td>Wayne’s World</td>
<td>1992</td>
<td>95</td>
<td>comedy</td>
</tr>
</tbody></table>
<ul>
<li><p>Attribute: Columns of a relation(<code>title, year, length, genre</code>)  </p>
</li>
<li><p>Tuple: Rows of a relation, other than the header row containing the attribute names (the first of the three tuples has the four components <code>Gone With the Wind, 1939, 231, drama</code> for attributes <code>title, year, length, and genre</code>). Each component of each tuple be atomic. It is not permitted for a value to be <code>set, list, array</code>. In the relational algebra of sets, duplicate tuples are always eliminated.     </p>
</li>
<li><p>Schema: Name of a relation and the set of attributes for a relation (<code>Movies(title, year, length, genre)</code>)  </p>
</li>
<li><p>Domain: Elementary type associated with each attribute of a relation (we could represent the schema for the <code>Movies</code> relation as <code>Movies(title:string, year:integer, length:integer, genre:string)</code>)  </p>
</li>
<li><p>Instance: A set of tuples for a given relation an instance of that relation.</p>
</li>
<li><p>Keys: Declare that the relation <code>Movies</code> has a key consisting of the two attributes <code>title</code> and <code>year</code>. That is, we don’t believe there could ever be two movies that had both the same title and the same year</p>
</li>
</ul>
<h4 id="Defining-a-Relation-Schema-in-SQL"><a href="#Defining-a-Relation-Schema-in-SQL" class="headerlink" title="Defining a Relation Schema in SQL"></a>Defining a Relation Schema in SQL</h4><h5 id="Data-Types"><a href="#Data-Types" class="headerlink" title="Data Types"></a>Data Types</h5><p><code>CHAR(n)</code>: A fixed-length string of up to <code>n</code> characters. Short strings are padded<br><code>VARCHAR(n)</code>: A string of up to <code>n</code> characters. An endmarker or string-length is used<br><code>BIT(n)</code>:  Bit strings of length n<br><code>BIT VARYING(n)</code>: Bit strings of length up to n<br><code>BOOLEAN</code>: TRUE, FALSE, UNKNOWN<br><code>INT</code> or <code>INTEGER</code>, <code>SHORTINT</code><br><code>FLOAT</code> or <code>REAL</code><br><code>DECIMAL(n,d)</code>: Values that consist of <code>n</code> decimal digits, with the decimal point assumed to be <code>d</code> positions from the right (<code>0123.45</code> is a possible value of type <code>DECIMAL(6,2)</code>)<br><code>DATE</code>: Keyword <code>DATE</code> followed by a quoted string of a special form (<code>DATE &#39;1948-05-14&#39;</code>)<br><code>TIME</code>: Keyword <code>TIME</code> and a quoted string. If fractions of a second are desired, we may continue with a decimal point (<code>TIME &#39;15:00:02.5&#39;</code> represents the time at 3 PM: two and a half seconds past three o’clock)</p>
<h5 id="Simple-Table-Declarations"><a href="#Simple-Table-Declarations" class="headerlink" title="Simple Table Declarations"></a>Simple Table Declarations</h5><ul>
<li>Declaration of a relation schema:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birthdate <span class="type">DATE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
The value of each of these components is set to the special null value, <code>NULL</code>.</li>
</ul>
<h5 id="Modifying-Relation-Schemas"><a href="#Modifying-Relation-Schemas" class="headerlink" title="Modifying Relation Schemas"></a>Modifying Relation Schemas</h5><ul>
<li>Delete a relation R by the SQL statement:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> R;</span><br></pre></td></tr></table></figure></li>
<li>Modify the <code>MovieStar</code> relation by adding an attribute <code>phone</code> with:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">ADD</span> phone <span class="type">CHAR</span>(<span class="number">16</span>);</span><br></pre></td></tr></table></figure></li>
<li>Delete the <code>birthdate</code> attribute:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">DROP</span> birthdate;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="Default-Values"><a href="#Default-Values" class="headerlink" title="Default Values"></a>Default Values</h5><ul>
<li>Replace the declarations of <code>gender</code> and <code>birthdate</code> by:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gender <span class="type">CHAR</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;?&#x27;</span>,</span><br><span class="line">birthdate <span class="type">DATE</span> <span class="keyword">DEFAULT</span> <span class="type">DATE</span> <span class="string">&#x27;0000-00-00&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>Declared the default value for new attribute <code>phone</code> to be <code>unlisted</code> when we added this attribute:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">ADD</span> phone <span class="type">CHAR</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;unlisted&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="Declaring-Keys"><a href="#Declaring-Keys" class="headerlink" title="Declaring Keys"></a>Declaring Keys</h5><ul>
<li><p>Key is a single attribute:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birthdate <span class="type">DATE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>OR</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birthdate <span class="type">DATE</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (name)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>UNIQUE</code> could replace <code>PRIMARY KEY</code>, and <code>NULL</code> is permitted then  </p>
</li>
<li><p>Key has more than one attribute:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Movies (</span><br><span class="line">    title <span class="type">CHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">year</span> <span class="type">INT</span>,</span><br><span class="line">    length <span class="type">INT</span>,</span><br><span class="line">    genre <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">    studioName <span class="type">CHAR</span>(<span class="number">30</span>),</span><br><span class="line">    producerC# <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (title, <span class="keyword">year</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="An-Algebraic-Query-Language"><a href="#An-Algebraic-Query-Language" class="headerlink" title="An Algebraic Query Language"></a>An Algebraic Query Language</h4><blockquote>
<p>Relational algebra is not used today as a query language in commercial<br>DBMS’s, although some of the early prototypes did use this algebra directly.<br>Rather, the “real” query language, SQL, incorporates relational algebra at its<br>center, and many SQL programs are really “syntactically sugared” expressions<br>of relational algebra. Further, when a DBMS processes queries, the first thing<br>that happens to a SQL query is that it gets translated into relational algebra<br>or a very similar internal representation. Thus, there are several good reasons<br>to start out learning this algebra.</p>
</blockquote>
<h5 id="Set-Operations-on-Relations"><a href="#Set-Operations-on-Relations" class="headerlink" title="Set Operations on Relations"></a>Set Operations on Relations</h5><p>$R \cup S$: the union of $R$ and $S$, is the set of elements that are in $R$ or $S$ or both. An element appears only once in the union even if it is present in both $R$ and $S$<br>$R \cap S$: the intersection of $R$ and $S$, is the set of elements that are in both $R$ and $S$<br>$R - S$: the difference of $R$ and $S$, is the set of elements that are in $R$ but not in $S$. Note that $R − S$ is different from $S − R$; the latter is the set of elements that are in $S$ but not in $R$.</p>
<h5 id="Projection"><a href="#Projection" class="headerlink" title="Projection"></a>Projection</h5><blockquote>
<p>The projection operator is used to produce from a relation $R$ a new relation that has only some of $R$’s columns. The value of expression $\pi_{A1,A2,\dots,An}(R)$ is a relation that has only the columns for attributes $A1, A2,\dots, An$ of $R$.  </p>
</blockquote>
<p>e.g.<br>$$\pi_{title,year,length}(\text{Movies})$$  </p>
<table>
<thead>
<tr>
<th>title</th>
<th>year</th>
<th>length</th>
</tr>
</thead>
<tbody><tr>
<td>Gone With the Wind</td>
<td>1939</td>
<td>231</td>
</tr>
<tr>
<td>Star Wars</td>
<td>1997</td>
<td>124</td>
</tr>
<tr>
<td>Wayne’s World</td>
<td>1992</td>
<td>95</td>
</tr>
</tbody></table>
<h5 id="Selection"><a href="#Selection" class="headerlink" title="Selection"></a>Selection</h5><blockquote>
<p>The selection operator, applied to a relation $R$, produces a new relation with a subset of $R$’s tuples. The tuples in the resulting relation are those that satisfy some condition $C$ that involves the attributes of $R$. We denote this operation $\sigma_{C}(R)$. The schema for the resulting relation is the same as $R$’s schema, and we conventionally show the attributes in the same order as we use for $R$  </p>
</blockquote>
<p>e.g.<br>$$\sigma_{length \geq 100}(\text{Movies})$$</p>
<table>
<thead>
<tr>
<th>title</th>
<th>year</th>
<th>length</th>
<th>genre</th>
</tr>
</thead>
<tbody><tr>
<td>Gone With the Wind</td>
<td>1939</td>
<td>231</td>
<td>drama</td>
</tr>
<tr>
<td>Star Wars</td>
<td>1997</td>
<td>124</td>
<td>sciFi</td>
</tr>
</tbody></table>
<p>$$\sigma_{length \geq 100 , \textrm{AND} , genre&#x3D;’drama’}(\text{Movies})$$</p>
<table>
<thead>
<tr>
<th>title</th>
<th>year</th>
<th>length</th>
<th>genre</th>
</tr>
</thead>
<tbody><tr>
<td>Gone With the Wind</td>
<td>1939</td>
<td>231</td>
<td>drama</td>
</tr>
</tbody></table>
<h5 id="Cartesian-Product"><a href="#Cartesian-Product" class="headerlink" title="Cartesian Product"></a>Cartesian Product</h5><blockquote>
<p>The Cartesian product (or cross-product, or just product) of two sets $R$ and $S$ is the set of pairs that can be formed by choosing the first element of the pair to be any element of $R$ and the second any element of $S$. This product is denoted $R × S$.  </p>
</blockquote>
<blockquote>
<p>When $R$ and $S$ are relations, the product is essentially the same. However, since the members of $R$ and $S$ are tuples, usually consisting of more than one component, the result of pairing a tuple from $R$ with a tuple from $S$ is a longer tuple, with one component for each of the components of the constituent tuples. By convention, the components from $R$ (the left operand) precede the components from $S$ in the attribute order for the result.  </p>
</blockquote>
<blockquote>
<p>if $R$ and $S$ should happen to have some attributes in common, then we need to invent new names for at least one of each pair of identical attributes. To disambiguate an attribute $A$ that is in the schemas of both $R$ and $S$, we use $R.A$ for the attribute from $R$ and $S.A$ for the attribute from $S$.  </p>
</blockquote>
<p>e.g.<br>Relation $R$:</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
</tr>
</tbody></table>
<p>Relation $S$:</p>
<table>
<thead>
<tr>
<th>B</th>
<th>C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>5</td>
<td>6</td>
</tr>
<tr>
<td>4</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td>9</td>
<td>10</td>
<td>11</td>
</tr>
</tbody></table>
<p>Relation $R × S$:</p>
<table>
<thead>
<tr>
<th>A</th>
<th>R.B</th>
<th>S.B</th>
<th>C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>2</td>
<td>5</td>
<td>6</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>4</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>9</td>
<td>10</td>
<td>11</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2</td>
<td>5</td>
<td>6</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>4</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>9</td>
<td>10</td>
<td>11</td>
</tr>
</tbody></table>
<p>The product $R × S$ consists of the six tuples. We paired each of the two tuples of $R$ with each of the three tuples of $S$. Since $B$ is an attribute of both schemas, we have used $R.B$ and $S.B$ in the schema for $R × S$. The other attributes are unambiguous, and their names appear in the resulting schema unchanged.</p>
<h5 id="Natural-Joins"><a href="#Natural-Joins" class="headerlink" title="Natural Joins"></a>Natural Joins</h5><blockquote>
<p>The natural join of two relations $R$ and $S$, denoted $R \bowtie S$, in which we pair only those tuples from $R$ and $S$ that agree in whatever attributes are common to the schemas of $R$ and $S$. More precisely, let $A_1, A_2, \dots, A_n$ be all the attributes that are in both the schema of $R$ and the schema of $S$. Then a tuple $r$ from $R$ and a tuple $s$ from $S$ are successfully paired if and only if $r$ and $s$ agree on each of the attributes $A_1, A_2, \dots, A_n$.</p>
</blockquote>
<p>e.g.<br>The natural join of the relations $R$ and $S$:</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>5</td>
<td>6</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>7</td>
<td>8</td>
</tr>
</tbody></table>
<p>The only attribute common to $R$ and $S$ is B. Thus, to pair successfully, tuples need only to agree in their $B$ components. Note that the third tuple of $S$ does not pair with any tuple of $R$ and thus has no effect on the result of $R \bowtie S$. A tuple that fails to pair with any tuple of the other relation in a join is said to be a <em>dangling tuple</em>.  </p>
<p>e.g.<br>Relation $U$:</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td>9</td>
<td>7</td>
<td>8</td>
</tr>
</tbody></table>
<p>Relation $V$:</p>
<table>
<thead>
<tr>
<th>B</th>
<th>C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>5</td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>10</td>
</tr>
</tbody></table>
<p>Relation $U \bowtie V$:</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>3</td>
<td>5</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>8</td>
<td>10</td>
</tr>
<tr>
<td>9</td>
<td>7</td>
<td>8</td>
<td>10</td>
</tr>
</tbody></table>
<p>For tuples to pair successfully, they must agree in both the $B$ and $C$ components. Thus, the first tuple of $U$ joins with the first two tuples of $V$ , while the second and third tuples of $U$ join with the third tuple of $V$.</p>
<h5 id="Theta-Joins"><a href="#Theta-Joins" class="headerlink" title="Theta-Joins"></a>Theta-Joins</h5><blockquote>
<p>The notation for a theta-join of relations $R$ and $S$ based on condition $C$ is $R \bowtie_{C} S$. The result of this operation is constructed as follows:  </p>
</blockquote>
<ol>
<li>Take the product of $R$ and $S$.  </li>
<li>Select from the product only those tuples that satisfy the condition $C$.</li>
</ol>
<p>e.g.<br>$$U \bowtie_{A&lt;D} V$$</p>
<table>
<thead>
<tr>
<th>A</th>
<th>U.B</th>
<th>U.C</th>
<th>V.B</th>
<th>V.C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>3</td>
<td>5</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>8</td>
<td>10</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>8</td>
<td>7</td>
<td>8</td>
<td>10</td>
</tr>
<tr>
<td>9</td>
<td>7</td>
<td>8</td>
<td>7</td>
<td>8</td>
<td>10</td>
</tr>
</tbody></table>
<p>Notice that the schema for the result consists of all six attributes, with $U$ and $V$ prefixed to their respective occurrences of attributes $B$ and $C$ to distinguish them. Thus, the theta-join contrasts with natural join, since in the latter common attributes are merged into one copy.  </p>
<p>e.g.<br>$$U \bowtie_{A&lt;D , \textrm{AND} , U.B \neq V.B} V$$</p>
<table>
<thead>
<tr>
<th>A</th>
<th>U.B</th>
<th>U.C</th>
<th>V.B</th>
<th>V.C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>3</td>
<td>7</td>
<td>8</td>
<td>10</td>
</tr>
</tbody></table>
<h5 id="Combining-Operations-to-Form-Queries"><a href="#Combining-Operations-to-Form-Queries" class="headerlink" title="Combining Operations to Form Queries"></a>Combining Operations to Form Queries</h5><p>e.g. What are the titles and years of movies made by Fox that are at least 100 minutes long?<br>$$\pi_{title, year}(\sigma_{length \geq 100}(\textrm{Movies}) \cap \sigma_{studioName&#x3D;\textrm{‘Fox’}}(\textrm{Movies}))$$<br>OR<br>$$\pi_{title, year}(\sigma_{length \geq 100 , \textrm{AND} , studioName&#x3D;\textrm{‘Fox’}}(\textrm{Movies}))$$</p>
<h5 id="Naming-and-Renaming"><a href="#Naming-and-Renaming" class="headerlink" title="Naming and Renaming"></a>Naming and Renaming</h5><blockquote>
<p>use the operator $\rho_{S(A_1,A_2,\dots,A_n)}(R)$ to rename a relation $R$. The resulting relation has exactly the same tuples as $R$, but the name of the relation is $S$. Moreover, the attributes of the result relation $S$ are named $A_1, A_2, \dots, A_n$, in order from the left. If we only want to change the name of the relation to $S$ and leave the attributes as they are in $R$, we can just say $\rho_{S}(R)$</p>
</blockquote>
<p>e.g.<br>$$R × \rho_{S(X,C,D)}(S)$$<br>OR<br>$$\rho_{RS(A,B,X,C,D)}(R × S)$$</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>X</th>
<th>C</th>
<th>D</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>2</td>
<td>5</td>
<td>6</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>4</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>9</td>
<td>10</td>
<td>11</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2</td>
<td>5</td>
<td>6</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>4</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>9</td>
<td>10</td>
<td>11</td>
</tr>
</tbody></table>
<h5 id="Relationships-Among-Operations"><a href="#Relationships-Among-Operations" class="headerlink" title="Relationships Among Operations"></a>Relationships Among Operations</h5><ol>
<li>$$R \cap S &#x3D; R - (R - S)$$</li>
<li>$$R \bowtie_{C} S &#x3D; \sigma_{C}(R × S)$$</li>
<li>Condition $C$ is $R.A_1&#x3D;S.A_1 , \textrm{AND} , R.A_2&#x3D;S.A_2 , \textrm{AND} , \dots , \textrm{AND} R.A_n&#x3D;S.A_n$<br>where $A_1, A_2, \dots, A_n$ are all the attributes appearing in the schemas of both $R$ and $S$.<br>Let $L$ be the list of attributes in the schema of $R$ followed by those attributes in the schema of $S$ that are not also in the schema of $R$<br>$$R \bowtie S &#x3D; \pi_{L}(\sigma_{C}(R × S))$$</li>
</ol>
<p>e.g. Theta-Join in the example has relationships:<br>$$U \bowtie_{A&lt;D , \textrm{AND} , U.B \neq V.B} V &#x3D; \sigma_{A&lt;D , \textrm{AND} , U.B \neq V.B}(U × V)$$</p>
<h5 id="A-Linear-Notation-for-Algebraic-Expressions"><a href="#A-Linear-Notation-for-Algebraic-Expressions" class="headerlink" title="A Linear Notation for Algebraic Expressions"></a>A Linear Notation for Algebraic Expressions</h5><blockquote>
<p>The notation we used for assignment statements is:  </p>
</blockquote>
<blockquote>
<ol>
<li>A relation name and parenthesized list of attributes for that relation. The name <em>Answer</em> will be used conventionally for the result of the final step; i.e., the name of the relation at the root of the expression tree</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>The assignment symbol :&#x3D;</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>Any algebraic expression on the right. We can choose to use only one operator per assignment, in which case each interior node of the tree gets its own assignment statement. However, it is also permissible to combine several algebraic operations in one right side, if it is convenient to do so.</li>
</ol>
</blockquote>
<p>e.g. $$\pi_{title, year}(\sigma_{length \geq 100}(\textrm{Movies}) \cap \sigma_{studioName&#x3D;\textrm{‘Fox’}}(\textrm{Movies}))$$<br>can be written as<br>$$\begin{align}<br>R(t,y,l,i,s,p) &amp;:&#x3D; \sigma_{length \geq 100}(\textrm{Movies}) \nonumber  \<br>S(t,y,l,i,s,p) &amp;:&#x3D; \sigma_{studioName&#x3D;\textrm{‘Fox’}}(\textrm{Movies}) \nonumber\<br>T(t,y,l,i,s,p) &amp;:&#x3D; R \cap S \nonumber\<br>\textrm{Answer}(title, year) &amp;:&#x3D; \pi_{t,y}(T) \nonumber<br>\end{align}$$</p>
<h4 id="Constraints-on-Relations"><a href="#Constraints-on-Relations" class="headerlink" title="Constraints on Relations"></a>Constraints on Relations</h4><ol>
<li>Referential Integrity Constraint<br>$\pi_{A}(R) \subseteq \pi_{B}(S)$, or equivalently, $\pi_{A}(R) - \pi_{B}(S) &#x3D; \emptyset$</li>
<li>Key Constraint<br>e.g.<br>$\sigma_{MS1.name &#x3D; MS2.name , \textrm{AND} , MS1.address \neq MS2.address}(MS1 × MS2) &#x3D; \emptyset$, where “name” is the key</li>
<li>Domain Constraint<br>e.g.<br>$\sigma_{gender \neq ‘F’ , \textrm{AND} , gender \neq ‘M’}(\textrm{MovieStar}) &#x3D; \emptyset$</li>
</ol>
<h3 id="Design-Theory-for-Relational-Databases"><a href="#Design-Theory-for-Relational-Databases" class="headerlink" title="Design Theory for Relational Databases"></a>Design Theory for Relational Databases</h3><h4 id="Functional-Dependencies"><a href="#Functional-Dependencies" class="headerlink" title="Functional Dependencies"></a>Functional Dependencies</h4><h5 id="Definition-of-Functional-Dependency"><a href="#Definition-of-Functional-Dependency" class="headerlink" title="Definition of Functional Dependency"></a>Definition of Functional Dependency</h5><blockquote>
<p>A <em>functional dependency</em> (FD) on a relation $R$ is a statement of the form “If two tuples of $R$ agree on all of the attributes $A_1, A_2, \dots , A_n$ (i.e., the tuples have the same values in their respective components for each of these attributes), then they must also agree on all of another list of attributes $B_1, B_2, \dots, B_m$. We write this FD formally as $A_{1} A_{2} \dots A_{n} \to B_{1} B_{2} \dots B_{m}$ and say that<br>$$A_1, A_2, \dots, A_n ; \textrm{functionally determine} ; B_1, B_2, \dots, B_m$$</p>
</blockquote>
<p>e.g.  </p>
<table>
<thead>
<tr>
<th>title</th>
<th>year</th>
<th>length</th>
<th>genre</th>
<th>studioName</th>
<th>starName</th>
</tr>
</thead>
<tbody><tr>
<td>Star Wars</td>
<td>1977</td>
<td>124</td>
<td>SciFi</td>
<td>Fox</td>
<td>Carrie Fisher</td>
</tr>
<tr>
<td>Star Wars</td>
<td>1977</td>
<td>124</td>
<td>SciFi</td>
<td>Fox</td>
<td>Mark Hamill</td>
</tr>
<tr>
<td>Star Wars</td>
<td>1977</td>
<td>124</td>
<td>SciFi</td>
<td>Fox</td>
<td>Harrison Ford</td>
</tr>
<tr>
<td>Gone With the Wind</td>
<td>1939</td>
<td>231</td>
<td>drama</td>
<td>MGM</td>
<td>Vivien Leigh</td>
</tr>
<tr>
<td>Wayne’s World</td>
<td>1992</td>
<td>95</td>
<td>comedy</td>
<td>Paramount</td>
<td>Dana Carvey</td>
</tr>
<tr>
<td>Wayne’s World</td>
<td>1992</td>
<td>95</td>
<td>comedy</td>
<td>Paramount</td>
<td>Mike Meyers</td>
</tr>
</tbody></table>
<p>The following FD holds:<br>$$\textrm{title year} \to \textrm{length genre studioName}$$</p>
<blockquote>
<p>Informally, this FD says that if two tuples have the same value in their <em><strong>title</strong></em> components, and they also have the same value in their <em><strong>year</strong></em> components, then these two tuples must also have the same values in their <em><strong>length</strong></em> components, the same values in their <em><strong>genre</strong></em> components, and the same values in their <em><strong>studioName</strong></em> components.</p>
</blockquote>
<blockquote>
<p>This assertion makes sense, since we believe that it is not possible for there to be two movies released in the same year with the same title (although there could be movies of the same title released in different years). Thus, we expect that given a title and year, there is a unique movie. Therefore, there is a unique length for the movie, a unique genre, and a unique studio.</p>
</blockquote>
<blockquote>
<p>$A_{1} A_{2} \dots A_{n} \to B$ is called a “functional” dependency because in principle there is a function that takes a list of values, one for each of attributes $A_1, A_2, \dots, A_n$ and produces a unique value (or no value at all) for $B$</p>
</blockquote>
<blockquote>
<p>The function is only computed by lookup in the relation. We look for a tuple with the given <em><strong>title</strong></em> and <em><strong>year</strong></em> values and see what value that tuple has for <em><strong>length</strong></em>.</p>
</blockquote>
<p>The following statement is false and it is not a functional dependency:<br>$$\textrm{title year} \to \textrm{starName}$$</p>
<h5 id="Keys-of-Relations"><a href="#Keys-of-Relations" class="headerlink" title="Keys of Relations"></a>Keys of Relations</h5><blockquote>
<p>We say a set of one or more attributes {$A_1, A_2, \dots, A_n$} is a key for a relation $R$ if:  </p>
</blockquote>
<ol>
<li>Those attributes functionally determine all other attributes of the relation. That is, it is impossible for two distinct tuples of $R$ to agree on all of $A_1, A_2, \dots, A_n$.  </li>
<li>No proper subset of {$A_1, A_2, \dots, A_n$} functionally determines all other attributes of $R$; i.e., a key must be minimal.<br>When a key consists of a single attribute $A$, we often say that $A$ (rather than {$A$}) is a key.</li>
</ol>
<h5 id="SuperKeys"><a href="#SuperKeys" class="headerlink" title="SuperKeys"></a>SuperKeys</h5><blockquote>
<p>A set of attributes that contains a key is called a <em><strong>superkey</strong></em>, short for “superset of a key.” Thus, every key is a superkey. However, some superkeys are not (minimal) keys. Note that every superkey satisfies the first condition of a key: it functionally determines all other attributes of the relation. However, a superkey need not satisfy the second condition: minimality</p>
</blockquote>
<p>e.g.<br>Not only is the key {$\textrm{title, year, starName}$} a superkey, but any superset of this set of attributes, such as {$\textrm{title, year, starName, length, studioName}$} is a superkey</p>
<h4 id="Rules-About-Functional-Dependencies"><a href="#Rules-About-Functional-Dependencies" class="headerlink" title="Rules About Functional Dependencies"></a>Rules About Functional Dependencies</h4><h5 id="The-Splitting-x2F-Combining-Rule"><a href="#The-Splitting-x2F-Combining-Rule" class="headerlink" title="The Splitting&#x2F;Combining Rule"></a>The Splitting&#x2F;Combining Rule</h5><p>$$A_1 A_2 \dots A_n \to B_1 B_2 \dots B_m$$<br>is equivalent to<br>$$A_1 A_2 \dots A_n \to B_i ; \textrm{for i &#x3D; 1,2,…,m}$$</p>
<h5 id="Trivial-Functional-Dependencies"><a href="#Trivial-Functional-Dependencies" class="headerlink" title="Trivial Functional Dependencies"></a>Trivial Functional Dependencies</h5><p>The FD $A_1 A_2 \dots A_n \to B_1 B_2 \dots B_m$ is equivalent to<br>$$A_1 A_2 \dots A_n \to C_1 C_2 \dots C_k$$<br>where the $C$’s are all those $B$’s that are not also $A$’s</p>
<h5 id="Computing-the-Closure-of-Attributes"><a href="#Computing-the-Closure-of-Attributes" class="headerlink" title="Computing the Closure of Attributes"></a>Computing the Closure of Attributes</h5><blockquote>
<p><em><strong>Algorithm 7</strong></em>: Closure of a Set of Attributes<br><em><strong>INPUT</strong></em>: A set of attributes ${A_1, A_2, \dots, A_n}$ and a set of FD’s $S$.<br><em><strong>OUTPUT</strong></em>: The closure ${A_1, A_2, \dots, A_n}^{+}$  </p>
</blockquote>
<ol>
<li>If necessary, split the FD’s of $S$, so each FD in $S$ has a single attribute on the right.  </li>
<li>Let $X$ be a set of attributes that eventually will become the closure. Initialize $X$ to be ${A_1, A_2, \dots, A_n}$.  </li>
<li>Repeatedly search for some FD<br>$$B_1 B_2 \dots B_m \to C$$<br>such that all of $B_1, B_2, \dots, B_m$ are in the set of attributes $X$, but $C$ is not. Add $C$ to the set $X$ and repeat the search. Since $X$ can only grow, and the number of attributes of any relation schema must be finite, eventually nothing more can be added to $X$, and this step ends.  </li>
<li>The set $X$, after no more attributes can be added to it, is the correct value of ${A_1, A_2, \dots, A_n}^{+}$.</li>
</ol>
<h5 id="The-Transitive-Rule"><a href="#The-Transitive-Rule" class="headerlink" title="The Transitive Rule"></a>The Transitive Rule</h5><h5 id="Closing-Sets-of-Functional-Dependencies"><a href="#Closing-Sets-of-Functional-Dependencies" class="headerlink" title="Closing Sets of Functional Dependencies"></a>Closing Sets of Functional Dependencies</h5><h5 id="Projecting-Functional-Dependencies"><a href="#Projecting-Functional-Dependencies" class="headerlink" title="Projecting Functional Dependencies"></a>Projecting Functional Dependencies</h5><h4 id="Design-of-Relational-Database-Schemas"><a href="#Design-of-Relational-Database-Schemas" class="headerlink" title="Design of Relational Database Schemas"></a>Design of Relational Database Schemas</h4><h5 id="Anomalies"><a href="#Anomalies" class="headerlink" title="Anomalies"></a>Anomalies</h5><h5 id="Decomposing-Relations"><a href="#Decomposing-Relations" class="headerlink" title="Decomposing Relations"></a>Decomposing Relations</h5><h5 id="Boyce-Codd-Normal-Form"><a href="#Boyce-Codd-Normal-Form" class="headerlink" title="Boyce-Codd Normal Form"></a>Boyce-Codd Normal Form</h5><blockquote>
<p>A relation $R$ is in BCNF if and only if: whenever there is a nontrivial FD $A_1 A_2 \dots A_n \to B_1 B_2 \dots B_m$ for $R$, it is the case that ${A_1, A_2, \dots, A_n}$ is a superkey for $R$.</p>
</blockquote>
<p>E.g. Consider a relation with schema {title, year, length, genre, studioName, starName} has FD:<br>$$\textrm{title} ; \textrm{year} \to \textrm{length} ; \textrm{genre} ; \textrm{studioName}$$<br>The left side of the above FD is not a superkey. In particular, we know that <em>title</em> and <em>year</em> do not functionally determine the sixth attribute, <em>starName</em>. Thus, the existence of this FD violates the BCNF condition and tells us this relation is not in BCNF</p>
<h5 id="Decomposition-into-BCNF"><a href="#Decomposition-into-BCNF" class="headerlink" title="Decomposition into BCNF"></a>Decomposition into BCNF</h5><blockquote>
<p><em><strong>Algorithm 20</strong></em>: BCNF Decomposition Algorithm<br><em><strong>INPUT</strong></em>: A relation $R_0$ with a set of functional dependencies $S_0$<br><em><strong>OUTPUT</strong></em>: A decomposition of $R_0$ into a collection of relations, all of which are in BCNF.<br><em><strong>METHOD</strong></em>: The following steps can be applied recursively to any relation $R$ and set of FD’s $S$. Initially, apply them with $R$ &#x3D; $R_0$ and $S$ &#x3D; $S_0$.  </p>
</blockquote>
<ol>
<li>Check whether $R$ is in BCNF. If so, nothing more needs to be done. Return ${R}$ as the answer.  </li>
<li>If there are BCNF violations, let one be $X \to Y$ . Use Algorithm 7 to compute $X^+$. Choose $R_1 &#x3D; X^+$ as one relation schema and let $R_2$ have attributes $X$ and those attributes of $R$ that are not in $X^+$.  </li>
<li>Use Algorithm 12 to compute the sets of FD’s for $R_1$ and $R_2$; let these be $S_1$ and $S_2$, respectively.  </li>
<li>Recursively decompose $R_1$ and $R_2$ using this algorithm. Return the union of the results of these decompositions.</li>
</ol>
<p>E.g. Consider<br>$$\textrm{title} ; \textrm{year} \to \textrm{length} ; \textrm{genre} ; \textrm{studioName}$$<br>is a BCNF violation. In this case, the right side already includes all the attributes functionally determined by <em>title</em> and <em>year</em>, so we shall use this BCNF violation to decompose the relation into:  </p>
<ol>
<li>The schema {title, year, length, genre, studioName} consisting of all the attributes on either side of the FD.  </li>
<li>The schema {title, year, starName} consisting of the left side of the FD plus all attributes of the relation that do not appear in either side of the FD (only starName, in this case).</li>
</ol>
<h3 id="High-Level-Database-Models"><a href="#High-Level-Database-Models" class="headerlink" title="High-Level Database Models"></a>High-Level Database Models</h3><h3 id="Algebraic-and-Logical-Query-Languages"><a href="#Algebraic-and-Logical-Query-Languages" class="headerlink" title="Algebraic and Logical Query Languages"></a>Algebraic and Logical Query Languages</h3><h3 id="The-Database-Language-SQL"><a href="#The-Database-Language-SQL" class="headerlink" title="The Database Language SQL"></a>The Database Language SQL</h3><h4 id="Simple-Queries-in-SQL"><a href="#Simple-Queries-in-SQL" class="headerlink" title="Simple Queries in SQL"></a>Simple Queries in SQL</h4><p>Movies(title, year, length, genre, studioName, producerC#)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--all movies produced by Disney Studios in 1990</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> studioName <span class="operator">=</span> ’Disney’ <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">1990</span>;</span><br></pre></td></tr></table></figure>

<h5 id="Projection-in-SQL"><a href="#Projection-in-SQL" class="headerlink" title="Projection in SQL"></a>Projection in SQL</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--produce only the movie title and length</span></span><br><span class="line"><span class="keyword">SELECT</span> title, length</span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> studioName <span class="operator">=</span> ’Disney’ <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">1990</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--produce a relation with attributes name and duration in place of title and length</span></span><br><span class="line"><span class="keyword">SELECT</span> title <span class="keyword">AS</span> name, length <span class="keyword">AS</span> duration</span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> studioName <span class="operator">=</span> ’Disney’ <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">1990</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--with the length in hours</span></span><br><span class="line"><span class="keyword">SELECT</span> title <span class="keyword">AS</span> name, length<span class="operator">*</span><span class="number">0.016667</span> <span class="keyword">AS</span> lengthInHours</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--allow a constant as an expression in the SELECT clause.</span></span><br><span class="line"><span class="keyword">SELECT</span> title, length<span class="operator">*</span><span class="number">0.016667</span> <span class="keyword">AS</span> length, ’hrs.’ <span class="keyword">AS</span> inHours</span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> studioName <span class="operator">=</span> ’Disney’ <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">1990</span>;</span><br></pre></td></tr></table></figure>

<h5 id="Selection-in-SQL"><a href="#Selection-in-SQL" class="headerlink" title="Selection in SQL"></a>Selection in SQL</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> title</span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> (<span class="keyword">year</span> <span class="operator">&gt;</span> <span class="number">1970</span> <span class="keyword">OR</span> length <span class="operator">&lt;</span> <span class="number">90</span>) <span class="keyword">AND</span> studioName <span class="operator">=</span> ’MGM’;</span><br></pre></td></tr></table></figure>

<h5 id="Comparison-of-Strings"><a href="#Comparison-of-Strings" class="headerlink" title="Comparison of Strings"></a>Comparison of Strings</h5><h5 id="Pattern-Matching-in-SQL"><a href="#Pattern-Matching-in-SQL" class="headerlink" title="Pattern Matching in SQL"></a>Pattern Matching in SQL</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s <span class="keyword">LIKE</span> p</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--The last four characters may be anything.</span></span><br><span class="line"><span class="keyword">SELECT</span> title</span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> title <span class="keyword">LIKE</span> ’Star ____’;</span><br><span class="line"><span class="comment">--results can be Star Wars and Star Trek.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--search for all movies with a possessive (’s) in their titles</span></span><br><span class="line"><span class="keyword">SELECT</span> title</span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> title <span class="keyword">LIKE</span> ’<span class="operator">%</span>’’s<span class="operator">%</span>’;</span><br><span class="line"><span class="comment">--’’s in a pattern is matched by a single apostrophe followed by an s.</span></span><br><span class="line"><span class="comment">-- results can be Logan’s Run or Alice’s Restaurant</span></span><br></pre></td></tr></table></figure>

<h5 id="Dates-and-Times"><a href="#Dates-and-Times" class="headerlink" title="Dates and Times"></a>Dates and Times</h5><h5 id="Null-Values-and-Comparisons-Involving-NULL"><a href="#Null-Values-and-Comparisons-Involving-NULL" class="headerlink" title="Null Values and Comparisons Involving NULL"></a>Null Values and Comparisons Involving NULL</h5><h5 id="The-Truth-Value-UNKNOWN"><a href="#The-Truth-Value-UNKNOWN" class="headerlink" title="The Truth-Value UNKNOWN"></a>The Truth-Value UNKNOWN</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> length <span class="operator">&lt;=</span> <span class="number">120</span> <span class="keyword">OR</span> length <span class="operator">&gt;</span> <span class="number">120</span>;</span><br><span class="line"><span class="comment">--the true meaning of the query is “find all the Movies tuples with non-NULL lengths.”</span></span><br></pre></td></tr></table></figure>

<h5 id="Ordering-the-Output"><a href="#Ordering-the-Output" class="headerlink" title="Ordering the Output"></a>Ordering the Output</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--get the movies listed by length, shortest first, and among movies of equal length, alphabetically</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">WHERE</span> studioName <span class="operator">=</span> ’Disney’ <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">1990</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> length, title;</span><br></pre></td></tr></table></figure>

<h4 id="Queries-Involving-More-Than-One-Relation"><a href="#Queries-Involving-More-Than-One-Relation" class="headerlink" title="Queries Involving More Than One Relation"></a>Queries Involving More Than One Relation</h4><h5 id="Products-and-Joins-in-SQL"><a href="#Products-and-Joins-in-SQL" class="headerlink" title="Products and Joins in SQL"></a>Products and Joins in SQL</h5><p>Movies(title, year, length, genre, studioName, producerC#)<br>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--get the name of the producer of Star Wars</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> Movies, MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> title <span class="operator">=</span> ’Star Wars’ <span class="keyword">AND</span> producerC# <span class="operator">=</span> cert#;</span><br></pre></td></tr></table></figure>

<h5 id="Disambiguating-Attributes"><a href="#Disambiguating-Attributes" class="headerlink" title="Disambiguating Attributes"></a>Disambiguating Attributes</h5><p>MovieStar(name, address, gender, birthdate)<br>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--find pairs consisting of a star and an executive with the same address.</span></span><br><span class="line"><span class="keyword">SELECT</span> MovieStar.name, MovieExec.name</span><br><span class="line"><span class="keyword">FROM</span> MovieStar, MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> MovieStar.address <span class="operator">=</span> MovieExec.address;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--The relation name, followed by a dot, is permissible even in situations where there is no ambiguity.</span></span><br><span class="line"><span class="keyword">SELECT</span> MovieExec.name</span><br><span class="line"><span class="keyword">FROM</span> Movies, MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> Movie.title <span class="operator">=</span> ’Star Wars’</span><br><span class="line"><span class="keyword">AND</span> Movie.producerC# <span class="operator">=</span> MovieExec.cert#;</span><br></pre></td></tr></table></figure>

<h5 id="Tuple-Variables"><a href="#Tuple-Variables" class="headerlink" title="Tuple Variables"></a>Tuple Variables</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--find two stars who share an address and use tuple variables as aliases for two uses of MovieStar</span></span><br><span class="line"><span class="keyword">SELECT</span> Star1.name, Star2.name</span><br><span class="line"><span class="keyword">FROM</span> MovieStar Star1, MovieStar Star2</span><br><span class="line"><span class="keyword">WHERE</span> Star1.address <span class="operator">=</span> Star2.address</span><br><span class="line"><span class="keyword">AND</span> Star1.name <span class="operator">&lt;</span> Star2.name;</span><br></pre></td></tr></table></figure>

<h5 id="Interpreting-Multirelation-Queries"><a href="#Interpreting-Multirelation-Queries" class="headerlink" title="Interpreting Multirelation Queries"></a>Interpreting Multirelation Queries</h5><h5 id="Union-Intersection-and-Difference-of-Queries"><a href="#Union-Intersection-and-Difference-of-Queries" class="headerlink" title="Union, Intersection, and Difference of Queries"></a>Union, Intersection, and Difference of Queries</h5><p>MovieStar(name, address, gender, birthdate)<br>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--the names and addresses of all female movie stars who are also movie executives with a net worth over $10,000,000</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, address</span><br><span class="line"><span class="keyword">FROM</span> MovieStar</span><br><span class="line"><span class="keyword">WHERE</span> gender <span class="operator">=</span> ’F’)</span><br><span class="line"><span class="keyword">INTERSECT</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, address</span><br><span class="line"><span class="keyword">FROM</span> MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> netWorth <span class="operator">&gt;</span> <span class="number">10000000</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--take the difference of two sets of persons, each selected from a relation.</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, address <span class="keyword">FROM</span> MovieStar)</span><br><span class="line"><span class="keyword">EXCEPT</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, address <span class="keyword">FROM</span> MovieExec);</span><br></pre></td></tr></table></figure>
<p>Movies(title, year, length, genre, studioName, producerC#)<br>StarsIn(movieTitle, movieYear, starName)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--find all the titles and years of movies that appeared in either the Movies or StarsIn relation</span></span><br><span class="line">(<span class="keyword">SELECT</span> title, <span class="keyword">year</span> <span class="keyword">FROM</span> Movie)</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line">(<span class="keyword">SELECT</span> movieTitle <span class="keyword">AS</span> title, movieYear <span class="keyword">AS</span> <span class="keyword">year</span> <span class="keyword">FROM</span> StarsIn);</span><br></pre></td></tr></table></figure>

<h4 id="Subqueries"><a href="#Subqueries" class="headerlink" title="Subqueries"></a>Subqueries</h4><h5 id="Subqueries-that-Produce-Scalar-Values"><a href="#Subqueries-that-Produce-Scalar-Values" class="headerlink" title="Subqueries that Produce Scalar Values"></a>Subqueries that Produce Scalar Values</h5><p>Movies(title, year, length, genre, studioName, producerC#)<br>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> cert# <span class="operator">=</span></span><br><span class="line">    (<span class="keyword">SELECT</span> producerC#</span><br><span class="line">    <span class="keyword">FROM</span> Movies</span><br><span class="line">    <span class="keyword">WHERE</span> title <span class="operator">=</span> ’Star Wars’</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
<p>as if it were</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> cert# <span class="operator">=</span> <span class="number">12345</span>;</span><br></pre></td></tr></table></figure>

<h5 id="Conditions-Involving-Relations"><a href="#Conditions-Involving-Relations" class="headerlink" title="Conditions Involving Relations"></a>Conditions Involving Relations</h5><h5 id="Conditions-Involving-Tuples"><a href="#Conditions-Involving-Tuples" class="headerlink" title="Conditions Involving Tuples"></a>Conditions Involving Tuples</h5><p>Movies(title, year, length, genre, studioName, producerC#)<br>StarsIn(movieTitle, movieYear, starName)<br>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Finding the producers of Harrison Ford’s movies</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> cert# <span class="keyword">IN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> producerC#</span><br><span class="line">    <span class="keyword">FROM</span> Movies</span><br><span class="line">    <span class="keyword">WHERE</span> (title, <span class="keyword">year</span>) <span class="keyword">IN</span></span><br><span class="line">        (<span class="keyword">SELECT</span> movieTitle, movieYear</span><br><span class="line">        <span class="keyword">FROM</span> StarsIn</span><br><span class="line">        <span class="keyword">WHERE</span> starName <span class="operator">=</span> ’Harrison Ford’</span><br><span class="line">        )</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Ford’s producers without nested subqueries</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> MovieExec, Movies, StarsIn</span><br><span class="line"><span class="keyword">WHERE</span> cert# <span class="operator">=</span> producerC# <span class="keyword">AND</span></span><br><span class="line">    title <span class="operator">=</span> movieTitle <span class="keyword">AND</span></span><br><span class="line">    <span class="keyword">year</span> <span class="operator">=</span> movieYear <span class="keyword">AND</span></span><br><span class="line">    starName <span class="operator">=</span> ’Harrison Ford’;</span><br></pre></td></tr></table></figure>

<h5 id="Correlated-Subqueries"><a href="#Correlated-Subqueries" class="headerlink" title="Correlated Subqueries"></a>Correlated Subqueries</h5><p>Movies(title, year, length, genre, studioName, producerC#)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Finding movie titles that appear more than once</span></span><br><span class="line"><span class="keyword">SELECT</span> title</span><br><span class="line"><span class="keyword">FROM</span> Movies <span class="keyword">Old</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">year</span> <span class="operator">&lt;</span> <span class="keyword">ANY</span></span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">year</span></span><br><span class="line">    <span class="keyword">FROM</span> Movies</span><br><span class="line">    <span class="keyword">WHERE</span> title <span class="operator">=</span> Old.title</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<h5 id="Subqueries-in-FROM-Clauses"><a href="#Subqueries-in-FROM-Clauses" class="headerlink" title="Subqueries in FROM Clauses"></a>Subqueries in FROM Clauses</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Finding the producers of Ford’s movies using a subquery in the FROM clause</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line"><span class="keyword">FROM</span> MovieExec, (<span class="keyword">SELECT</span> producerC#</span><br><span class="line">                <span class="keyword">FROM</span> Movies, StarsIn</span><br><span class="line">                <span class="keyword">WHERE</span> title <span class="operator">=</span> movieTitle <span class="keyword">AND</span></span><br><span class="line">                <span class="keyword">year</span> <span class="operator">=</span> movieYear <span class="keyword">AND</span></span><br><span class="line">                starName <span class="operator">=</span> ’Harrison Ford’</span><br><span class="line">                ) Prod</span><br><span class="line"><span class="keyword">WHERE</span> cert# <span class="operator">=</span> Prod.producerC#;</span><br></pre></td></tr></table></figure>

<h5 id="SQL-Join-Expressions"><a href="#SQL-Join-Expressions" class="headerlink" title="SQL Join Expressions"></a>SQL Join Expressions</h5><p>Movies(title, year, length, genre, studioName, producerC#)<br>StarsIn(movieTitle, movieYear, starName)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Movies <span class="keyword">JOIN</span> StarsIn <span class="keyword">ON</span></span><br><span class="line">    title <span class="operator">=</span> movieTitle <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> movieYear;</span><br><span class="line"><span class="comment">--a tuple from Movies and one from StarsIn combine to form a tuple of the result only if the two tuples agree on both the title and year.</span></span><br><span class="line"><span class="comment">--two of the columns are redundant, because every tuple of the result will have the same value in both the title and movieTitle components and will have the same value in both year and movieYear.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--remove redundant components</span></span><br><span class="line"><span class="keyword">SELECT</span> title, <span class="keyword">year</span>, length, genre, studioName,</span><br><span class="line">    producerC#, starName</span><br><span class="line"><span class="keyword">FROM</span> Movies <span class="keyword">JOIN</span> StarsIn <span class="keyword">ON</span></span><br><span class="line">    title <span class="operator">=</span> movieTitle <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> movieYear;</span><br></pre></td></tr></table></figure>

<h5 id="Natural-Joins-1"><a href="#Natural-Joins-1" class="headerlink" title="Natural Joins"></a>Natural Joins</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MovieStar <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> MovieExec;</span><br></pre></td></tr></table></figure>

<h5 id="Outerjoins"><a href="#Outerjoins" class="headerlink" title="Outerjoins"></a>Outerjoins</h5><p>MovieStar(name, address, gender, birthdate)<br>MovieExec(name, address, cert#, netWorth)</p>
<table>
<thead>
<tr>
<th>name</th>
<th>address</th>
<th>gender</th>
<th>birthdate</th>
<th>cert#</th>
<th>networth</th>
</tr>
</thead>
<tbody><tr>
<td>Mary</td>
<td>Maple St.</td>
<td>‘F’</td>
<td>9&#x2F;9&#x2F;99</td>
<td>12345</td>
<td>$100..</td>
</tr>
<tr>
<td>Tom</td>
<td>Cherry Ln.</td>
<td>‘M’</td>
<td>8&#x2F;8&#x2F;88</td>
<td>NULL</td>
<td>NULL</td>
</tr>
<tr>
<td>George</td>
<td>Oak Rd.</td>
<td>NULL</td>
<td>NULL</td>
<td>23456</td>
<td>$200..</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- The result of this operation is above, a relation with the same six-attribute schema. The tuples of this relation are of three kinds.</span></span><br><span class="line">MovieStar <span class="keyword">NATURAL</span> <span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> MovieExec;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- yield the first two tuples but not the third</span></span><br><span class="line">MovieStar <span class="keyword">NATURAL</span> <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> MovieExec;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- yield the first and third tuples but not the second</span></span><br><span class="line">MovieStar <span class="keyword">NATURAL</span> <span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> MovieExec;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Next, suppose we want a theta-outerjoin instead of a natural outerjoin. Instead of using the keyword <em>NATURAL</em>, we may follow the join by <em>ON</em> and a condition that matching tuples must obey. If we also specify <em>FULL OUTER JOIN</em>, then after matching tuples from the two joined relations, we pad dangling tuples of either relation with NULL’s and include the padded tuples in the result</p>
</blockquote>
<p>Movies(title, year, length, genre, studioName, producerC#)<br>StarsIn(movieTitle, movieYear, starName)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--  shall get not only tuples for movies that have at least one star mentioned in StarsIn, but we shall get tuples for movies with no listed stars, padded with NULL’s in attributes movieTitle, movieYear, and starName. Likewise, for stars not appearing in any movie listed in relation Movies we get a tuple with NULL’s in the six attributes of Movies.</span></span><br><span class="line">Movies <span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> StarsIn <span class="keyword">ON</span></span><br><span class="line">    title <span class="operator">=</span> movieTitle <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> movieYear;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- gives us the Movies tuples with at least one listed star and NULL-padded Movies tuples without a listed star, but will not include stars without a listed movie</span></span><br><span class="line">Movies <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> StarsIn <span class="keyword">ON</span></span><br><span class="line">    title <span class="operator">=</span> movieTitle <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> movieYear;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- omit the tuples for movies without a listed star but will include tuples for stars not in any listed movies, padded with NULL’s.</span></span><br><span class="line">Movies <span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> StarsIn <span class="keyword">ON</span>  </span><br><span class="line">    title <span class="operator">=</span> movieTitle <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> movieYear;</span><br></pre></td></tr></table></figure>

<h4 id="Full-Relation-Operations"><a href="#Full-Relation-Operations" class="headerlink" title="Full-Relation Operations"></a>Full-Relation Operations</h4><h5 id="Eliminating-Duplicates"><a href="#Eliminating-Duplicates" class="headerlink" title="Eliminating Duplicates"></a>Eliminating Duplicates</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> name</span><br></pre></td></tr></table></figure>

<h5 id="Duplicates-in-Unions-Intersections-and-Differences"><a href="#Duplicates-in-Unions-Intersections-and-Differences" class="headerlink" title="Duplicates in Unions, Intersections, and Differences"></a>Duplicates in Unions, Intersections, and Differences</h5><blockquote>
<p>Unlike the <em>SELECT</em> statement, which preserves duplicates as a default and only eliminates them when instructed to by the <em>DISTINCT</em> keyword, the union, intersection, and difference operations, normally eliminate duplicates. That is, bags are converted to sets, and the set version of the operation is applied. In order to prevent the elimination of duplicates, we must follow the operator <em>UNION</em>, <em>INTERSECT</em>, or <em>EXCEPT</em> by the keyword <strong>ALL</strong>. If we do, then we get the bag semantics of these operators.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> title, <span class="keyword">year</span> <span class="keyword">FROM</span> Movies)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">(<span class="keyword">SELECT</span> movieTitle <span class="keyword">AS</span> title, movieYear <span class="keyword">AS</span> <span class="keyword">year</span> <span class="keyword">FROM</span> StarsIn);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- If R and S are relations, then the result of expression is the relation in which the number of times a tuple t appears is the minimum of the number of times it appears in R and the number of times it appears in S.</span></span><br><span class="line">R <span class="keyword">INTERSECT</span> <span class="keyword">ALL</span> S</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- The result of expression has tuple t as many times as the difference of the number of times it appears in R minus the number of times it appears in S, provided the difference is positive</span></span><br><span class="line">R <span class="keyword">EXCEPT</span> <span class="keyword">ALL</span> S</span><br></pre></td></tr></table></figure>

<h5 id="Grouping-and-Aggregation-in-SQL"><a href="#Grouping-and-Aggregation-in-SQL" class="headerlink" title="Grouping and Aggregation in SQL"></a>Grouping and Aggregation in SQL</h5><h5 id="Aggregation-Operators"><a href="#Aggregation-Operators" class="headerlink" title="Aggregation Operators"></a>Aggregation Operators</h5><p>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(netWorth)</span><br><span class="line"><span class="keyword">FROM</span> MovieExec;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> StarsIn;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(starName)</span><br><span class="line"><span class="keyword">FROM</span> StarsIn;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> starName)</span><br><span class="line"><span class="keyword">FROM</span> StarsIn;</span><br></pre></td></tr></table></figure>

<h5 id="Grouping"><a href="#Grouping" class="headerlink" title="Grouping"></a>Grouping</h5><p>Movies(title, year, length, genre, studioName, producerC#)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> studioName, <span class="built_in">SUM</span>(length)</span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> studioName;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>In a <em>SELECT</em> clause that has aggregations, only those attributes<br>that are mentioned in the <em>GROUP BY</em> clause may appear unaggregated in<br>the <em>SELECT</em> clause.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> studioName</span><br><span class="line"><span class="keyword">FROM</span> Movies</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> studioName;</span><br></pre></td></tr></table></figure>
<p>the above query has the same effect as</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> studioName</span><br><span class="line"><span class="keyword">FROM</span> Movies;</span><br></pre></td></tr></table></figure>

<p>Movies(title, year, length, genre, studioName, producerC#)<br>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- print a table listing each producer’s total length of film produced.</span></span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">SUM</span>(length)</span><br><span class="line"><span class="keyword">FROM</span> MovieExec, Movies</span><br><span class="line"><span class="keyword">WHERE</span> producerC# <span class="operator">=</span> cert# <span class="comment">--taking their theta-join, equating the certificate numbers from the two relations.</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> name;</span><br></pre></td></tr></table></figure>

<h5 id="Grouping-Aggregation-and-Nulls"><a href="#Grouping-Aggregation-and-Nulls" class="headerlink" title="Grouping, Aggregation, and Nulls"></a>Grouping, Aggregation, and Nulls</h5><blockquote>
<p><code>COUNT(*)</code> is always a count of the number of tuples in a relation, but <code>COUNT(A)</code> is the number of tuples with <em>non-NULL</em> values for attribute <em>A</em>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
</tr>
</thead>
<tbody><tr>
<td>NULL</td>
<td>NULL</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- the result is the one tuple (NULL, 0)</span></span><br><span class="line"><span class="keyword">SELECT</span> A, <span class="built_in">COUNT</span>(B)</span><br><span class="line"><span class="keyword">FROM</span> R</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> A;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- the result is the one tuple (NULL, NULL).</span></span><br><span class="line"><span class="keyword">SELECT</span> A, <span class="built_in">SUM</span>(B)</span><br><span class="line"><span class="keyword">FROM</span> R</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> A;</span><br></pre></td></tr></table></figure>

<h5 id="HAVING-Clauses"><a href="#HAVING-Clauses" class="headerlink" title="HAVING Clauses"></a>HAVING Clauses</h5><blockquote>
<p>Sometimes we want to choose our groups based on some aggregate property of the group itself. Then we follow the <em>GROUP BY</em> clause with a <em>HAVING</em> clause. The latter clause consists of the keyword <em>HAVING</em> followed by a condition about the group</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- print the total film length for only those producers who made at least one film prior to 1930</span></span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">SUM</span>(length)</span><br><span class="line"><span class="keyword">FROM</span> MovieExec, Movies</span><br><span class="line"><span class="keyword">WHERE</span> producerC# <span class="operator">=</span> cert#</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> name;</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MIN</span>(<span class="keyword">year</span>) <span class="operator">&lt;</span> <span class="number">1930</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>There are several rules about HAVING clauses:  </p>
</blockquote>
<ul>
<li>An aggregation in a <em>HAVING</em> clause applies only to the tuples of the group being tested.  </li>
<li>Any attribute of relations in the <em>FROM</em> clause may be aggregated in the <em>HAVING</em> clause, but only those attributes that are in the <em>GROUP BY</em> list may appear unaggregated in the <em>HAVING</em> clause (the same rule as for the <em>SELECT</em> clause).</li>
</ul>
<blockquote>
<p>We have now met all six clauses that can appear in a SQL “select-fromwhere” query: <em>SELECT</em>, <em>FROM</em>, <em>WHERE</em>, <em>GROUP BY</em>, <em>HAVING</em>, and <em>ORDER BY</em>. Only the <em>SELECT</em> and <em>FROM</em> clauses are required. Whichever additional clauses appear must be in the order listed above.</p>
</blockquote>
<h4 id="Database-Modifications"><a href="#Database-Modifications" class="headerlink" title="Database Modifications"></a>Database Modifications</h4><h5 id="Insertion"><a href="#Insertion" class="headerlink" title="Insertion"></a>Insertion</h5><p><code>INSERT INTO R(A1, . . . , An) VALUES (v1, . . . , vn);</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StarsIn(movieTitle, movieYear, starName)</span><br><span class="line"><span class="keyword">VALUES</span>(’The Maltese Falcon’, <span class="number">1942</span>, ’Sydney Greenstreet’);</span><br></pre></td></tr></table></figure>
<p>Or</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- must be sure that the order of the values is the same as the standard order of attributes for the relation.</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StarsIn</span><br><span class="line"><span class="keyword">VALUES</span>(’The Maltese Falcon’, <span class="number">1942</span>, ’Sydney Greenstreet’);</span><br></pre></td></tr></table></figure>

<p>Studio(name, address, presC#)<br>Movies(title, year, length, genre, studioName, producerC#)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- insert with NULL for the attributes address and presC#, into relation Studio</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Studio(name)</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> studioName</span><br><span class="line">    <span class="keyword">FROM</span> Movies</span><br><span class="line">    <span class="keyword">WHERE</span> studioName <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">        (<span class="keyword">SELECT</span> name</span><br><span class="line">        <span class="keyword">FROM</span> Studio);</span><br></pre></td></tr></table></figure>

<h5 id="Deletion"><a href="#Deletion" class="headerlink" title="Deletion"></a>Deletion</h5><p><code>DELETE FROM R WHERE &lt;condition&gt;;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- must describe the tuple exactly by a WHERE clause</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> StarsIn</span><br><span class="line"><span class="keyword">WHERE</span> movieTitle <span class="operator">=</span> <span class="string">&#x27;The Maltese Falcon&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">    movieYear <span class="operator">=</span> <span class="number">1942</span> <span class="keyword">AND</span></span><br><span class="line">    starName <span class="operator">=</span> <span class="string">&#x27;Sydney Greenstreet&#x27;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> netWorth <span class="operator">&lt;</span> <span class="number">10000000</span>;</span><br></pre></td></tr></table></figure>

<h5 id="Updates"><a href="#Updates" class="headerlink" title="Updates"></a>Updates</h5><p><code>UPDATE R SET &lt;new-value assignments&gt; WHERE &lt;condition&gt;;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- attach the title Pres. in front of the name of every movie executive who is the president of a studio.</span></span><br><span class="line"><span class="keyword">UPDATE</span> MovieExec</span><br><span class="line"><span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;Pres. &#x27;</span> <span class="operator">||</span> name <span class="comment">-- the operator || denotes concatenation of strings</span></span><br><span class="line"><span class="keyword">WHERE</span> cert# <span class="keyword">IN</span> (<span class="keyword">SELECT</span> presC# <span class="keyword">FROM</span> Studio);</span><br></pre></td></tr></table></figure>

<h4 id="Transactions-in-SQL"><a href="#Transactions-in-SQL" class="headerlink" title="Transactions in SQL"></a>Transactions in SQL</h4><h5 id="Serializability"><a href="#Serializability" class="headerlink" title="Serializability"></a>Serializability</h5><h5 id="Atomicity"><a href="#Atomicity" class="headerlink" title="Atomicity"></a>Atomicity</h5><h5 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h5><h5 id="Read-Only-Transactionss"><a href="#Read-Only-Transactionss" class="headerlink" title="Read-Only Transactionss"></a>Read-Only Transactionss</h5><h5 id="Dirty-Reads"><a href="#Dirty-Reads" class="headerlink" title="Dirty Reads"></a>Dirty Reads</h5><h5 id="Other-Isolation-Levels"><a href="#Other-Isolation-Levels" class="headerlink" title="Other Isolation Levels"></a>Other Isolation Levels</h5><h3 id="Constraints-and-Triggers"><a href="#Constraints-and-Triggers" class="headerlink" title="Constraints and Triggers"></a>Constraints and Triggers</h3><h4 id="Keys-and-Foreign-Key"><a href="#Keys-and-Foreign-Key" class="headerlink" title="Keys and Foreign Key"></a>Keys and Foreign Key</h4><h5 id="Declaring-Foreign-Key-Constraints"><a href="#Declaring-Foreign-Key-Constraints" class="headerlink" title="Declaring Foreign-Key Constraints"></a>Declaring Foreign-Key Constraints</h5><p>Define an attribute or attributes to be a key for a relation with the keywords <code>PRIMARY KEY</code> or <code>UNIQUE</code>.<br>“foreign-key constraints,” assert that a value appearing in one relation must also appear in the primary-key component(s) of another relation.  </p>
<p><code>REFERENCES &lt;table&gt;(&lt;attribute&gt;)</code><br><code>FOREIGN KEY (&lt;attributes&gt;) REFERENCES &lt;table&gt;(&lt;attributes&gt;)</code>  </p>
<p>Studio(name, address, presC#)<br>MovieExec(name, address, cert#, netWorth)<br>Studio’s primary key is name and has a foreign key presC# that references cert# of relation MovieExec.<br>cert# in MovieExec must be a key of that relation.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- declare presC# directly to reference cert# as follows</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Studio (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    presC# <span class="type">INT</span> <span class="keyword">REFERENCES</span> MovieExec(cert#)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Or</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Studio (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    presC# <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (presC#) <span class="keyword">REFERENCES</span> MovieExec(cert#)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="Maintaining-Referential-Integrity"><a href="#Maintaining-Referential-Integrity" class="headerlink" title="Maintaining Referential Integrity"></a>Maintaining Referential Integrity</h5><ul>
<li>The Default Policy</li>
<li>The Cascade Policy</li>
<li>The Set-Null Policy</li>
</ul>
<p>Studio(name, address, presC#)<br>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Studio (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    presC# <span class="type">INT</span> <span class="keyword">REFERENCES</span> MovieExec(cert#)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="Deferred-Checking-of-Constraints"><a href="#Deferred-Checking-of-Constraints" class="headerlink" title="Deferred Checking of Constraints"></a>Deferred Checking of Constraints</h5><p><code>DEFERRABLE</code> and <code>NOT DEFERRABLE</code><br><code>INITIALLY DEFERRED</code> and <code>INITIALLY IMMEDIATE</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Studio (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    presC# <span class="type">INT</span> <span class="keyword">UNIQUE</span></span><br><span class="line">        <span class="keyword">REFERENCES</span> MovieExec(cert#)</span><br><span class="line">        DEFERRABLE INITIALLY DEFERRED</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- If a constraint has a name, say MyConstraint, then we can change a deferrable constraint from immediate to deferred by the SQL statement, and we can reverse the process by replacing DEFERRED to IMMEDIATE.</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">CONSTRAINT</span> MyConstraint DEFERRED;</span><br></pre></td></tr></table></figure>

<h4 id="Constraints-on-Attributes-and-Tuples"><a href="#Constraints-on-Attributes-and-Tuples" class="headerlink" title="Constraints on Attributes and Tuples"></a>Constraints on Attributes and Tuples</h4><h5 id="Not-Null-Constraints"><a href="#Not-Null-Constraints" class="headerlink" title="Not-Null Constraints"></a>Not-Null Constraints</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Studio (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    presC# <span class="type">INT</span> <span class="keyword">REFERENCES</span> MovieExec(cert#) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="Attribute-Based-CHECK-Constraints"><a href="#Attribute-Based-CHECK-Constraints" class="headerlink" title="Attribute-Based CHECK Constraints"></a>Attribute-Based CHECK Constraints</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- require that certificate numbers be at least six digits.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Studio (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    presC# <span class="type">INT</span> <span class="keyword">REFERENCES</span> MovieExec(cert#)</span><br><span class="line">                <span class="keyword">CHECK</span> (presC# <span class="operator">&gt;=</span> <span class="number">100000</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>MovieStar(name, address, gender, birthdate)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">1</span>) <span class="keyword">CHECK</span> (gender <span class="keyword">IN</span> (<span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;M&#x27;</span>)),</span><br><span class="line">    birthdate <span class="type">DATE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="Tuple-Based-CHECK-Constraints"><a href="#Tuple-Based-CHECK-Constraints" class="headerlink" title="Tuple-Based CHECK Constraints"></a>Tuple-Based CHECK Constraints</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birthdate <span class="type">DATE</span>,</span><br><span class="line">    <span class="keyword">CHECK</span> (gender <span class="operator">=</span> ’F’ <span class="keyword">OR</span> name <span class="keyword">NOT</span> <span class="keyword">LIKE</span> ’Ms.<span class="operator">%</span>’)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="Comparison-of-Tuple-and-Attribute-Based-Constraints"><a href="#Comparison-of-Tuple-and-Attribute-Based-Constraints" class="headerlink" title="Comparison of Tuple- and Attribute-Based Constraints"></a>Comparison of Tuple- and Attribute-Based Constraints</h5><blockquote>
<p>If a constraint on a tuple involves more than one attribute of that tuple, then it must be written as a tuple-based constraint. However, if the constraint involves only one attribute of the tuple, then it can be written as either a tuple- or attribute-based constraint.</p>
</blockquote>
<h4 id="Modification-of-Constraints"><a href="#Modification-of-Constraints" class="headerlink" title="Modification of Constraints"></a>Modification of Constraints</h4><h5 id="Giving-Names-to-Constraints"><a href="#Giving-Names-to-Constraints" class="headerlink" title="Giving Names to Constraints"></a>Giving Names to Constraints</h5><blockquote>
<p>In order to modify or delete an existing constraint, it is necessary that the constraint have a name. To do so, we precede the constraint by the keyword <strong>CONSTRAINT</strong> and a name for the constraint.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- write a line to name the constraint that says attribute name is a primary key</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">CONSTRAINT</span> NameIsKey <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birthdate <span class="type">DATE</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- name the attribute-based CHECK constraint</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">1</span>) <span class="keyword">CONSTRAINT</span> NoAndro</span><br><span class="line">                   <span class="keyword">CHECK</span> (gender <span class="keyword">IN</span> (’F’, ’M’)),</span><br><span class="line">    birthdate <span class="type">DATE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- rewriting of the tuple-based CHECK constraint to give that constraint a name</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MovieStar (</span><br><span class="line">    name <span class="type">CHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    birthdate <span class="type">DATE</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> RightTitle</span><br><span class="line">        <span class="keyword">CHECK</span> (gender <span class="operator">=</span> ’F’ <span class="keyword">OR</span> name <span class="keyword">NOT</span> <span class="keyword">LIKE</span> ’Ms.<span class="operator">%</span>’);</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="Altering-Constraints-on-Tables"><a href="#Altering-Constraints-on-Tables" class="headerlink" title="Altering Constraints on Tables"></a>Altering Constraints on Tables</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- drop the constraints</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> NameIsKey;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> NoAndro;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> RightTitle;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- add these constraints</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> NameIsKey</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (name);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> NoAndro</span><br><span class="line">    <span class="keyword">CHECK</span> (gender <span class="keyword">IN</span> (’F’, ’M’));</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> MovieStar <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> RightTitle</span><br><span class="line">    <span class="keyword">CHECK</span> (gender <span class="operator">=</span> ’F’ <span class="keyword">OR</span> name <span class="keyword">NOT</span> <span class="keyword">LIKE</span> ’Ms.<span class="operator">%</span>’);</span><br></pre></td></tr></table></figure>

<h4 id="Assertions"><a href="#Assertions" class="headerlink" title="Assertions"></a>Assertions</h4><p>• An assertion is a boolean-valued SQL expression that must be true at all times.<br>• A trigger is a series of actions that are associated with certain events, such as insertions into a particular relation, and that are performed whenever these events arise.</p>
<h5 id="Creating-Assertions"><a href="#Creating-Assertions" class="headerlink" title="Creating Assertions"></a>Creating Assertions</h5><p><code>CREATE ASSERTION &lt;assertion-name&gt; CHECK (&lt;condition&gt;)</code></p>
<h5 id="Using-Assertions"><a href="#Using-Assertions" class="headerlink" title="Using Assertions"></a>Using Assertions</h5><blockquote>
<p>Any attributes referred to in the condition must be introduced in the assertion, typically by mentioning their relation in a select-from-where expression.</p>
</blockquote>
<p>MovieExec(name, address, cert#, netWorth)<br>Studio(name, address, presC#)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- require that no one can become the president of a studio unless their net worth is at least $10,000,000</span></span><br><span class="line"><span class="keyword">CREATE</span> ASSERTION RichPres <span class="keyword">CHECK</span></span><br><span class="line">    (<span class="keyword">NOT</span> <span class="keyword">EXISTS</span></span><br><span class="line">        (<span class="keyword">SELECT</span> Studio.name</span><br><span class="line">        <span class="keyword">FROM</span> Studio, MovieExec</span><br><span class="line">        <span class="keyword">WHERE</span> presC# <span class="operator">=</span> cert# <span class="keyword">AND</span> netWorth <span class="operator">&lt;</span> <span class="number">10000000</span></span><br><span class="line">        )</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p>Movies(title, year, length, genre, studioName, producerC#)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- the total length of all movies by a given studio shall not exceed 10,000 minutes.</span></span><br><span class="line"><span class="keyword">CREATE</span> ASSERTION SumLength <span class="keyword">CHECK</span> (<span class="number">10000</span> <span class="operator">&gt;=</span> <span class="keyword">ALL</span></span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">SUM</span>(length) <span class="keyword">FROM</span> Movies <span class="keyword">GROUP</span> <span class="keyword">BY</span> studioName)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- drop an assertion</span></span><br><span class="line"><span class="keyword">DROP</span> ASSERTION <span class="operator">&lt;</span>assertion name<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Triggers"><a href="#Triggers" class="headerlink" title="Triggers"></a>Triggers</h4><h5 id="Triggers-in-SQL"><a href="#Triggers-in-SQL" class="headerlink" title="Triggers in SQL"></a>Triggers in SQL</h5><p>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- The effect of this trigger is to foil any attempt to lower the net worth of a movie executive</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> NetWorthTrigger</span><br><span class="line">AFTER <span class="keyword">UPDATE</span> <span class="keyword">OF</span> netWorth <span class="keyword">ON</span> MovieExec</span><br><span class="line"><span class="keyword">REFERENCING</span></span><br><span class="line">    <span class="keyword">OLD</span> <span class="type">ROW</span> <span class="keyword">AS</span> OldTuple,</span><br><span class="line">    <span class="keyword">NEW</span> <span class="type">ROW</span> <span class="keyword">AS</span> NewTuple</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="comment">-- this trigger is executed once for each updated tuple</span></span><br><span class="line"><span class="keyword">WHEN</span> (OldTuple.netWorth <span class="operator">&gt;</span> NewTuple.netWorth)</span><br><span class="line">    <span class="keyword">UPDATE</span> MovieExec</span><br><span class="line">    <span class="keyword">SET</span> netWorth <span class="operator">=</span> OldTuple.netWorth</span><br><span class="line">    <span class="keyword">WHERE</span> cert# <span class="operator">=</span> NewTuple.cert#;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Besides <em>UPDATE</em>, other possible triggering events are <em>INSERT</em> and <em>DELETE</em>. The <em>OF netWorth</em> clause is optional for <em>UPDATE</em> events, and if present defines the event to be only an update of the attribute(s) listed after the keyword <em>OF</em>. An <em>OF</em> clause is not permitted for <em>INSERT</em> or <em>DELETE</em> events; these events make sense for entire tuples only.</p>
</blockquote>
<blockquote>
<p>If the triggering event is an insertion, then we may use a <em>NEW ROW AS</em> clause to give a name for the inserted tuple, and <em>OLD ROW AS</em> is disallowed. Conversely, on a deletion <em>OLD ROW AS</em> is used to name the deleted tuple and <em>NEW ROW AS</em> is disallowed</p>
</blockquote>
<blockquote>
<p>If we update an entire table with a SQL update statement, a statement-level update trigger would execute only once, while a row-level trigger would execute once for each tuple to which an update was applied.</p>
</blockquote>
<h5 id="The-Options-for-Trigger-Design"><a href="#The-Options-for-Trigger-Design" class="headerlink" title="The Options for Trigger Design"></a>The Options for Trigger Design</h5><p>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- prevent the average net worth of movie executives from dropping below $500,000. show the trigger for the update event.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> AvgNetWorthTrigger</span><br><span class="line">AFTER <span class="keyword">UPDATE</span> <span class="keyword">OF</span> netWorth <span class="keyword">ON</span> MovieExec</span><br><span class="line"><span class="keyword">REFERENCING</span></span><br><span class="line">    <span class="keyword">OLD</span> <span class="keyword">TABLE</span> <span class="keyword">AS</span> OldStuff,</span><br><span class="line">    <span class="keyword">NEW</span> <span class="keyword">TABLE</span> <span class="keyword">AS</span> NewStuff</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> STATEMENT <span class="comment">-- this trigger is executed once for a statement, regardless of how many tuples are modified</span></span><br><span class="line"><span class="keyword">WHEN</span> (<span class="number">500000</span> <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(netWorth) <span class="keyword">FROM</span> MovieExec)) <span class="comment">-- This condition is satisfied if the average net worth after the update is less than $500,000.</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DELETE</span> <span class="keyword">FROM</span> MovieExec</span><br><span class="line">    <span class="keyword">WHERE</span> (name, address, cert#, netWorth) <span class="keyword">IN</span> NewStuff; <span class="comment">-- remove all the new tuples</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> MovieExec</span><br><span class="line">        (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> OldStuff); <span class="comment">-- restore the old relation MovieExec</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>Movies(title, year, length, genre, studioName, producerC#)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> FixYearTrigger</span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> Movies</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="comment">-- define names for both the new row being inserted and a table consisting of only that row</span></span><br><span class="line">    <span class="keyword">NEW</span> <span class="type">ROW</span> <span class="keyword">AS</span> NewRow</span><br><span class="line">    <span class="keyword">NEW</span> <span class="keyword">TABLE</span> <span class="keyword">AS</span> NewStuff</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="comment">-- the trigger executes once for each inserted tuple</span></span><br><span class="line"><span class="keyword">WHEN</span> NewRow.year <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UPDATE</span> NewStuff <span class="keyword">SET</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">1915</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Views-and-Indexes"><a href="#Views-and-Indexes" class="headerlink" title="Views and Indexes"></a>Views and Indexes</h3><h4 id="Virtual-Views"><a href="#Virtual-Views" class="headerlink" title="Virtual Views"></a>Virtual Views</h4><p>Virtual views are not stored in the database, but can be queried as if they existed.</p>
<h5 id="Declaring-Views"><a href="#Declaring-Views" class="headerlink" title="Declaring Views"></a>Declaring Views</h5><p>Movies(title, year, length, genre, studioName, producerC#)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- have a view that is a part of the relation, specifically, the titles and years of the movies made by Paramount Studios.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> ParamountMovies <span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">SELECT</span> title, <span class="keyword">year</span></span><br><span class="line">    <span class="keyword">FROM</span> Movies</span><br><span class="line">    <span class="keyword">WHERE</span> studioName <span class="operator">=</span> <span class="string">&#x27;Paramount&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>Movies(title, year, length, genre, studioName, producerC#)<br>MovieExec(name, address, cert#, netWorth)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Define a view MovieProd with movie titles and the names of their producers</span></span><br><span class="line"><span class="comment">-- The following view definition joins the two relations and requires that the certificate numbers match. It then extracts the movie title and producer name from pairs of tuples that agree on the certificates.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> MovieProd <span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">SELECT</span> title, name</span><br><span class="line">    <span class="keyword">FROM</span> Movies, MovieExec</span><br><span class="line">    <span class="keyword">WHERE</span> producerC# <span class="operator">=</span> cert#;</span><br></pre></td></tr></table></figure>

<h5 id="Querying-Views"><a href="#Querying-Views" class="headerlink" title="Querying Views"></a>Querying Views</h5><p>A view may be queried exactly as if it were a stored table. We mention its name in a <em>FROM</em> clause and rely on the DBMS to produce the needed tuples by operating on the relations used to define the virtual view.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> title</span><br><span class="line"><span class="keyword">FROM</span> ParamountMovies</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">1979</span>;</span><br></pre></td></tr></table></figure>

<p>It is also possible to write queries involving both views and base tables</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> starName</span><br><span class="line"><span class="keyword">FROM</span> ParamountMovies, StarsIn</span><br><span class="line"><span class="keyword">WHERE</span> title <span class="operator">=</span> movieTitle <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> movieYear;</span><br></pre></td></tr></table></figure>

<h5 id="Renaming-Attributes"><a href="#Renaming-Attributes" class="headerlink" title="Renaming Attributes"></a>Renaming Attributes</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Its columns are headed by attributes movieTitle and prodName instead of title and name.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> MovieProd(movieTitle, prodName) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> title, name</span><br><span class="line"><span class="keyword">FROM</span> Movies, MovieExec</span><br><span class="line"><span class="keyword">WHERE</span> producerC# <span class="operator">=</span> cert#;</span><br></pre></td></tr></table></figure>

<h4 id="Modifying-Views"><a href="#Modifying-Views" class="headerlink" title="Modifying Views"></a>Modifying Views</h4><p>An update on the updatable view can be applied directly to the underlying relation <em>R</em></p>
<h5 id="View-Removal"><a href="#View-Removal" class="headerlink" title="View Removal"></a>View Removal</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> ParamountMovies;</span><br></pre></td></tr></table></figure>

<h5 id="Updatable-Views"><a href="#Updatable-Views" class="headerlink" title="Updatable Views"></a>Updatable Views</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ParamountMovies</span><br><span class="line"><span class="keyword">VALUES</span>(’Star Trek’, <span class="number">1979</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> ParamountMovies</span><br><span class="line"><span class="keyword">WHERE</span> title <span class="keyword">LIKE</span> ’<span class="operator">%</span>Trek<span class="operator">%</span>’;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> ParamountMovies</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">1979</span></span><br><span class="line"><span class="keyword">WHERE</span> title <span class="operator">=</span> ’Star Trek the Movie’;</span><br></pre></td></tr></table></figure>

<h5 id="Instead-Of-Triggers-on-Views"><a href="#Instead-Of-Triggers-on-Views" class="headerlink" title="Instead-Of Triggers on Views"></a>Instead-Of Triggers on Views</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> ParamountInsert</span><br><span class="line">    INSTEAD <span class="keyword">OF</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> ParamountMovies</span><br><span class="line">    <span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="type">ROW</span> <span class="keyword">AS</span> NewRow</span><br><span class="line">        <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> Movies(title, <span class="keyword">year</span>, studioName)</span><br><span class="line">        <span class="keyword">VALUES</span>(NewRow.title, NewRow.year, ’Paramount’);</span><br></pre></td></tr></table></figure>

<h4 id="Indexes-in-SQL"><a href="#Indexes-in-SQL" class="headerlink" title="Indexes in SQL"></a>Indexes in SQL</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- have an index on attribute year for the relation Movies</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX YearIndex <span class="keyword">ON</span> Movies(<span class="keyword">year</span>);</span><br></pre></td></tr></table></figure>

<p>DBMS allows us to build a single index on multiple attributes. This type of index takes values for several attributes and efficiently finds the tuples with the given values for these attributes.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX KeyIndex <span class="keyword">ON</span> Movies(title, <span class="keyword">year</span>);</span><br></pre></td></tr></table></figure>

<p>If we were more likely to specify a year than a title for a movie, then we would prefer to order the attributes as:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX KeyIndex <span class="keyword">ON</span> Movies(<span class="keyword">year</span>, title);</span><br></pre></td></tr></table></figure>

<p>If we wish to delete the index, we simply use its name in a statement like:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX YearIndex;</span><br></pre></td></tr></table></figure>

<h4 id="Selection-of-Indexes"><a href="#Selection-of-Indexes" class="headerlink" title="Selection of Indexes"></a>Selection of Indexes</h4><h4 id="Materialized-Views"><a href="#Materialized-Views" class="headerlink" title="Materialized Views"></a>Materialized Views</h4><h3 id="Index-Structures"><a href="#Index-Structures" class="headerlink" title="Index Structures"></a>Index Structures</h3><h3 id="Parallel-and-Distributed-Databases"><a href="#Parallel-and-Distributed-Databases" class="headerlink" title="Parallel and Distributed Databases"></a>Parallel and Distributed Databases</h3><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>Database Systems-The Complete Book(2nd ed, 2014, Pearson)</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Relational-Algebra/" rel="tag"># Relational Algebra</a>
              <a href="/tags/SQL/" rel="tag"># SQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/12/10/Art-Style-Transfer/" rel="prev" title="Build a Website with Flask - Art Style Transfer">
                  <i class="fa fa-chevron-left"></i> Build a Website with Flask - Art Style Transfer
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/07/11/Breakout-Ball/" rel="next" title="Build a Game with Java - Breakout Ball">
                  Build a Game with Java - Breakout Ball <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhqyvvn</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"zhqyvvn","repo":"zhqyvvn.github.io","client_id":"c28a59a6f171f3e27313","client_secret":"a31ffbb812ba7a28cd66045ae2a68e017e9d539f","admin_user":"zhqyvvn","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"eaefa5e7c3587db462ee24c42fd75852"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
