<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhqyvvn.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":true,"transition":{"menu_item":"flipInX","post_block":"none","post_header":"flipInX","post_body":"none","coll_header":"flipInX","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Note: This tutorial imitates The Ultimate Ethereum Dapp Tutorial but creates a different app. BackgroundIn this tutorial, We can learn how to build a web application where customers can get&#x2F;remov">
<meta property="og:type" content="article">
<meta property="og:title" content="Build a Decentralized App - Museum Pass Card Promotions">
<meta property="og:url" content="http://zhqyvvn.github.io/2020/09/09/Tutorial-on-DApp/index.html">
<meta property="og:site_name" content="Tech Knowledge Sharing">
<meta property="og:description" content="Note: This tutorial imitates The Ultimate Ethereum Dapp Tutorial but creates a different app. BackgroundIn this tutorial, We can learn how to build a web application where customers can get&#x2F;remov">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://zhqyvvn.github.io/images/tut_img/ganache.png">
<meta property="og:image" content="http://zhqyvvn.github.io/images/tut_img/metamask.png">
<meta property="og:image" content="http://zhqyvvn.github.io/images/tut_img/import.png">
<meta property="og:image" content="http://zhqyvvn.github.io/images/tut_img/connect.png">
<meta property="og:image" content="http://zhqyvvn.github.io/images/tut_img/home.png">
<meta property="og:image" content="http://zhqyvvn.github.io/images/tut_img/transaction.png">
<meta property="og:image" content="http://zhqyvvn.github.io/images/tut_img/img1.png">
<meta property="og:image" content="http://zhqyvvn.github.io/images/tut_img/img2.png">
<meta property="article:published_time" content="2020-09-10T02:38:50.000Z">
<meta property="article:modified_time" content="2023-01-27T23:28:51.819Z">
<meta property="article:author" content="zhqyvvn">
<meta property="article:tag" content="Blockchain">
<meta property="article:tag" content="Solidity">
<meta property="article:tag" content="Ethereum">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zhqyvvn.github.io/images/tut_img/ganache.png">


<link rel="canonical" href="http://zhqyvvn.github.io/2020/09/09/Tutorial-on-DApp/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://zhqyvvn.github.io/2020/09/09/Tutorial-on-DApp/","path":"2020/09/09/Tutorial-on-DApp/","title":"Build a Decentralized App - Museum Pass Card Promotions"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Build a Decentralized App - Museum Pass Card Promotions | Tech Knowledge Sharing</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162128119-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-162128119-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tech Knowledge Sharing</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Background"><span class="nav-text">Background</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-Framework-and-Softwares"><span class="nav-text">Install Framework and Softwares</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step1-Model-Museums"><span class="nav-text">Step1 - Model Museums</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step2-Test-Museum-Model"><span class="nav-text">Step2 - Test Museum Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step3-Model-User-Information-and-Add-Functions"><span class="nav-text">Step3 - Model User Information and Add Functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step4-Test-User-Model-and-Functions"><span class="nav-text">Step4 - Test User Model and Functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step5-Client-Side-Application"><span class="nav-text">Step5 - Client-Side Application</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step5-Watch-Events"><span class="nav-text">Step5 - Watch Events</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference"><span class="nav-text">Reference</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dependencies"><span class="nav-text">Dependencies</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhqyvvn"
      src="https://avatars0.githubusercontent.com/u/38484412?s=460&v=4">
  <p class="site-author-name" itemprop="name">zhqyvvn</p>
  <div class="site-description" itemprop="description">I'm a Java developer wearing glasses ...coz I don't C#</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zhqyvvn" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhqyvvn" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhqyvvn@gmail.com" title="E-Mail → mailto:zhqyvvn@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://zhqyvvn.github.io/2020/09/09/Tutorial-on-DApp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/38484412?s=460&v=4">
      <meta itemprop="name" content="zhqyvvn">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tech Knowledge Sharing">
      <meta itemprop="description" content="I'm a Java developer wearing glasses ...coz I don't C#">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Build a Decentralized App - Museum Pass Card Promotions | Tech Knowledge Sharing">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Build a Decentralized App - Museum Pass Card Promotions
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-09 22:38:50" itemprop="dateCreated datePublished" datetime="2020-09-09T22:38:50-04:00">2020-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-01-27 18:28:51" itemprop="dateModified" datetime="2023-01-27T18:28:51-05:00">2023-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tutorial/" itemprop="url" rel="index"><span itemprop="name">Tutorial</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><strong>Note</strong>: This tutorial imitates <a target="_blank" rel="noopener" href="https://www.dappuniversity.com/articles/the-ultimate-ethereum-dapp-tutorial">The Ultimate Ethereum Dapp Tutorial</a> but creates a different app.</p>
<h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>In this tutorial, We can learn how to build a web application where customers can get&#x2F;remove museums’ pass cards. Pass cards from different museums have different expiration date, and every museum has a limitation on the number of pass cards they released.  </p>
<p>If we were to build our application on the centralized web, we’d run into a few problems:  </p>
<span id="more"></span>
<ol>
<li>The data on the database could be changed: expiration date of pass cards could be changed, so one pass card could be used forever in this case; the number limitation of museums’ pass cards could be changed, unlimited free pass cards would cause a huge loss for museums.  </li>
<li>The source code on the web server could also be changed at any time.</li>
</ol>
<blockquote>
<p>Instead of a centralized database, all the transaction data that is shared across the nodes in the blockchain is contained in bundles of records called blocks, which are chained together to create the public ledger. This public ledger represents all the data in the blockchain. All the data in the public ledger is secured by cryptographic hashing, and validated by a consensus algorithm. Nodes on the network participate to ensure that all copies of the data distributed across the network are the same.  </p>
</blockquote>
<p>For these reasons, we can build it on the blockchain to ensure that the information of pass cards and its number limitation cannot be changed, and people cannot get the duplicate pass cards from the same museums if they’ve already got one.  </p>
<p>For users of this application, they needs an account with a wallet address with some Ether. Once they connect to the network, they can get and remove their pass cards and pay “gas” to write their transactions to the blockchain.  </p>
<p>We’ll build the front-end client written in HTML, CSS, and Javascript. This client will connect to Ganache, a local Ethereum blockchain. And we’ll code all the business logic about our DApp in the smart contract written in the Solidity. We’ll develop our DApp in the Truffle framework. MetaMask needs to be pre-installed on chrome with the private account imported from Ganache to connect to the local Ethereum blockchain, and interact with the smart contract deployed on the blockchain. Other dependencies are listed in the <a href="#dependencies">last section</a> of this tutorial.  </p>
<p><em>Complete code of this tutorial can be found in the github repo <a target="_blank" rel="noopener" href="https://github.com/zhqyvvn/Tutorial-on-DApp">zhqyvvn&#x2F;Tutorial-on-DApp</a></em></p>
<h3 id="Install-Framework-and-Softwares"><a href="#Install-Framework-and-Softwares" class="headerlink" title="Install Framework and Softwares"></a>Install Framework and Softwares</h3><ul>
<li>Install Truffle with NPM<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm install -g truffle</span></span><br></pre></td></tr></table></figure></li>
<li><a target="_blank" rel="noopener" href="https://www.trufflesuite.com/ganache">Install Ganache</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn?hl=en">Get Metamask extension for Google Chrome</a></li>
</ul>
<h3 id="Step1-Model-Museums"><a href="#Step1-Model-Museums" class="headerlink" title="Step1 - Model Museums"></a>Step1 - Model Museums</h3><p>Open Ganache and have a local blockchain running. Ganache gave us 10 accounts preloaded with 100 fake Ether. Each account has a unique address and a private key. Each account address will serve as a unique identifier for each user in our DApp.  </p>
<p><img data-src="/images/tut_img/ganache.png"></p>
<p>Now let’s create a project directory for our DApp in the command line like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> museum</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> museum</span></span><br></pre></td></tr></table></figure>

<p>Inside our newly created directory, Get up and run fast with a fundamental Truffle box:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle unbox pet-shop</span></span><br></pre></td></tr></table></figure>

<p>From the root of our project, create a new contract file in the contracts directory like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">touch</span> contracts/Passcard.sol</span></span><br></pre></td></tr></table></figure>
<p>Or we can create it manually. Also in this contracts directory, delete <code>Migrations.sol</code>.</p>
<p>We need a way to store multiple museums, and store multiple attributes about each museum. We want to keep track of a museum’s id, name, description, address, open hours, avatar image source path, the expiration date of pass cards and to count the number of remaining pass cards of a museum. Here is how we will model the museum - Open the <code>Passcard.sol</code> file and start with the following code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.5.16;</span><br><span class="line"></span><br><span class="line">contract Passcard &#123;</span><br><span class="line"></span><br><span class="line">  //Model a Museum</span><br><span class="line">  struct Museum &#123;</span><br><span class="line">    uint id;</span><br><span class="line">    string name;</span><br><span class="line">    string description;</span><br><span class="line">    string addr;</span><br><span class="line">    string hour;</span><br><span class="line">    string imgsrc;</span><br><span class="line">    string expire_date;</span><br><span class="line">    uint count_remain;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We have modeled the museum with a Solidity Struct. We specified that this struct has an id of unsigned integer type, name of string type, description of string type, address of string type, open hours of string type, image path of string type, expiration date of string type, and remaining number of pass cards of unsigned integer type.  </p>
<p>We need a place to store the <code>Museum</code> structure type that we’ve just created. We can do this with a Solidity mapping.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.5.16;</span><br><span class="line"></span><br><span class="line">contract Passcard &#123;</span><br><span class="line"></span><br><span class="line">  //Model a Museum</span><br><span class="line">  struct Museum &#123;</span><br><span class="line">    uint id;</span><br><span class="line">    string name;</span><br><span class="line">    string description;</span><br><span class="line">    string addr;</span><br><span class="line">    string hour;</span><br><span class="line">    string imgsrc;</span><br><span class="line">    string expire_date;</span><br><span class="line">    uint count_remain;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //Read/Write museums&#x27; information</span><br><span class="line">  mapping(uint =&gt; Museum) public museums;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In this case, the key to the mapping is an unsigned integer, and the value is a Museum structure type that we just defined. This essentially gives us an id-based look up for each museum.   </p>
<p>Next, we keep track of how many museums exist in the contract with a counter cache state variable  <code>museumsCount</code> like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.5.16;</span><br><span class="line"></span><br><span class="line">contract Passcard &#123;</span><br><span class="line"></span><br><span class="line">  //Model a Museum</span><br><span class="line">  struct Museum &#123;</span><br><span class="line">    uint id;</span><br><span class="line">    string name;</span><br><span class="line">    string description;</span><br><span class="line">    string addr;</span><br><span class="line">    string hour;</span><br><span class="line">    string imgsrc;</span><br><span class="line">    string expire_date;</span><br><span class="line">    uint count_remain;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //Read/Write museums&#x27; information</span><br><span class="line">  mapping(uint =&gt; Museum) public museums;</span><br><span class="line"></span><br><span class="line">  //keep track of museum counts</span><br><span class="line">  uint public museumsCount;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In Solidity, there is no way to determine the size of a mapping, and no way to iterate over it, either. Therefore, we should use a counter cache.  </p>
<p>Next, let’s create a function to add museums to the mapping we’ve created like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">contract Passcard &#123;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  //function for adding museum</span><br><span class="line">  function addMuseum (string memory _name, string memory _description,</span><br><span class="line">    string memory _addr, string memory _hours, string memory _imgsrc,</span><br><span class="line">    string memory _date, uint _count) private &#123;</span><br><span class="line">      museumsCount += 1;</span><br><span class="line">      museums[museumsCount] = Museum(museumsCount, _name, _description, _addr, _hours,</span><br><span class="line">        _imgsrc, _date, _count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Inside the function, we increment the <code>museumsCount</code> counter cache to denote that a new museum has been added. Then we update the mapping with a new Museum struct, using the current <code>museumsCount</code> count as the key. The initialized museum id is also the current <code>museumsCount</code> count.  </p>
<p>Now we can add four museums with mock data to our contract by calling the <code>addMuseum</code> function four times inside the constructor function like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">contract Passcard &#123;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  //Constructor</span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    //add mock data</span><br><span class="line">    addMuseum(&quot;Royal Ontario Museum&quot;,</span><br><span class="line">    &quot;It is one of the largest museums in North America and the largest in Canada.&quot;,</span><br><span class="line">    &quot;100 Queens Park, Toronto, ON&quot;, &quot;Mon-Fri, 10a.m.-5:30p.m.&quot;, &quot;./images/on_royal.jpg&quot;, &quot;2020-09-15&quot;, 10);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Gardiner Museum&quot;,</span><br><span class="line">    &quot;The collection is made up of two types of ceramics, earthenware, and porcelain.&quot;,</span><br><span class="line">    &quot;111 Queens Park, Toronto, ON&quot;, &quot;Mon-Fri, 10a.m.-6:00p.m.&quot;, &quot;./images/gardiner.jpg&quot;, &quot;2020-10-08&quot;, 30);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Art Gallery of Ontario&quot;,</span><br><span class="line">    &quot;Its permanent collection represents many artistic movements and eras of art history.&quot;,</span><br><span class="line">    &quot;317 Dundas St W, Toronto, ON&quot;, &quot;Mon-Fri, 10:30a.m.-5p.m.&quot;, &quot;./images/ago.jpg&quot;, &quot;2020-11-20&quot;, 25);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Textile Museum of Canada&quot;,</span><br><span class="line">    &quot;It is a museum dedicated to the collection, exhibition, and documentation of textiles.&quot;,</span><br><span class="line">    &quot;55 Centre Ave, Toronto, ON&quot;, &quot;Mon-Sun, 11a.m.-5p.m.&quot;, &quot;./images/textile.jpg&quot;, &quot;2020-12-16&quot;, 1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At this point, your contract code should look like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.5.16;</span><br><span class="line"></span><br><span class="line">contract Passcard &#123;</span><br><span class="line"></span><br><span class="line">  //Model a Museum</span><br><span class="line">  struct Museum &#123;</span><br><span class="line">    uint id;</span><br><span class="line">    string name;</span><br><span class="line">    string description;</span><br><span class="line">    string addr;</span><br><span class="line">    string hour;</span><br><span class="line">    string imgsrc;</span><br><span class="line">    string expire_date;</span><br><span class="line">    uint count_remain;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //Read/Write museums&#x27; information</span><br><span class="line">  mapping(uint =&gt; Museum) public museums;</span><br><span class="line"></span><br><span class="line">  //keep track of museum counts</span><br><span class="line">  uint public museumsCount;</span><br><span class="line"></span><br><span class="line">  //Constructor</span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    //add mock data</span><br><span class="line">    addMuseum(&quot;Royal Ontario Museum&quot;,</span><br><span class="line">    &quot;It is one of the largest museums in North America and the largest in Canada.&quot;,</span><br><span class="line">    &quot;100 Queens Park, Toronto, ON&quot;, &quot;Mon-Fri, 10a.m.-5:30p.m.&quot;, &quot;./images/on_royal.jpg&quot;, &quot;2020-09-15&quot;, 10);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Gardiner Museum&quot;,</span><br><span class="line">    &quot;The collection is made up of two types of ceramics, earthenware, and porcelain.&quot;,</span><br><span class="line">    &quot;111 Queens Park, Toronto, ON&quot;, &quot;Mon-Fri, 10a.m.-6:00p.m.&quot;, &quot;./images/gardiner.jpg&quot;, &quot;2020-10-08&quot;, 30);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Art Gallery of Ontario&quot;,</span><br><span class="line">    &quot;Its permanent collection represents many artistic movements and eras of art history.&quot;,</span><br><span class="line">    &quot;317 Dundas St W, Toronto, ON&quot;, &quot;Mon-Fri, 10:30a.m.-5p.m.&quot;, &quot;./images/ago.jpg&quot;, &quot;2020-11-20&quot;, 25);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Textile Museum of Canada&quot;,</span><br><span class="line">    &quot;It is a museum dedicated to the collection, exhibition, and documentation of textiles.&quot;,</span><br><span class="line">    &quot;55 Centre Ave, Toronto, ON&quot;, &quot;Mon-Sun, 11a.m.-5p.m.&quot;, &quot;./images/textile.jpg&quot;, &quot;2020-12-16&quot;, 1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //function for adding museum</span><br><span class="line">  function addMuseum (string memory _name, string memory _description,</span><br><span class="line">    string memory _addr, string memory _hours, string memory _imgsrc,</span><br><span class="line">    string memory _date, uint _count) private &#123;</span><br><span class="line">      museumsCount += 1;</span><br><span class="line">      museums[museumsCount] = Museum(museumsCount, _name, _description, _addr, _hours,</span><br><span class="line">        _imgsrc, _date, _count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next we’ll need to create a new file in the “migrations” directory. From our project root, create a new file from the command line like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">touch</span> migrations/1_museum_passcard.js</span></span><br></pre></td></tr></table></figure>
<p>Or we can create it manually. Also we need to delete <code>1_initial_migration.js</code> there.</p>
<p>Let’s create a new migration to deploy the contract like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Passcard</span> = artifacts.<span class="built_in">require</span>(<span class="string">&quot;./Passcard.sol&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">deployer</span>) &#123;</span><br><span class="line">  deployer.<span class="title function_">deploy</span>(<span class="title class_">Passcard</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Now let’s run our migrations from the command line like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle migrate</span></span><br></pre></td></tr></table></figure>
<p>Make sure the Ganache is running at the same time.</p>
<p>Now that we have successfully migrated our smart contract to the local Ethereum blockchain, let’s open the console to interact with the smart contract. You can open the truffle console from the command line like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle console</span></span><br></pre></td></tr></table></figure>

<p>Now that we’re inside the console, let’s get an instance of our deployed smart contract and see if we can read the museum’s information from the contract.  </p>
<p>From the console, run this code:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Passcard.deployed().then(function(instance) &#123; app = instance &#125;)</span><br></pre></td></tr></table></figure>
<p>Now we can get information of our museums, for instance, to get our first museum, we can write code in truffle console like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.museums(1).then(function(i) &#123;museum = i&#125;)</span><br></pre></td></tr></table></figure>
<p>And read its information like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">museum[0].toNumber()    //read the id of the museum</span><br><span class="line">museum[1]    //read the name of the museum</span><br><span class="line">museum[2]    //read the description of the museum</span><br><span class="line">museum[3]    //read the address of the museum</span><br><span class="line">museum[4]    //read the open hours of the museum</span><br><span class="line">museum[5]    //read where the avatar image of the museum stored</span><br><span class="line">museum[6]    //read the expiration date of the museums&#x27; pass cards</span><br><span class="line">museum[7].toNumber()  //read the number of remaining pass cards users can get from this museum</span><br></pre></td></tr></table></figure>

<p>Congratulations! You’ve just written your first smart contract, deployed to the blockchain, and retrieved some of its data.</p>
<p>Note: For images of the four museums in our contract, we can download their images from websites and store them in the <code>src/images</code> directory, and name it with <code>on_royal.jpg</code>, <code>gardiner.jpg</code>, <code>ago.jpg</code>, <code>textile.jpg</code> separately. And we can delete images <code>golden-retriever.jpeg</code>, <code>boxer.jpeg</code>, <code>french-bulldog.jpeg</code>, <code>scottish-terrier.jpeg</code> in that directory.</p>
<h3 id="Step2-Test-Museum-Model"><a href="#Step2-Test-Museum-Model" class="headerlink" title="Step2 - Test Museum Model"></a>Step2 - Test Museum Model</h3><p>Now let’s write some tests. Make sure you have Ganache running first. Then, create a new test file in the command line from the root of our project like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">touch</span> <span class="built_in">test</span>/passcard.js</span></span><br></pre></td></tr></table></figure>
<p>Or we can create it manually.  </p>
<p>We’ll write some tests in Javascript to simulate client-side interaction with our smart contract, much like we did in the console.  </p>
<p>Here is the code for the tests:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Passcard</span> = artifacts.<span class="built_in">require</span>(<span class="string">&quot;./Passcard.sol&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">contract</span>(<span class="string">&quot;Passcard&quot;</span>, <span class="keyword">function</span>(<span class="params">accounts</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> passcardInstance;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;initializes with four museums&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> instance.<span class="title function_">museumsCount</span>();</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">count</span>) &#123;</span><br><span class="line">      assert.<span class="title function_">equal</span>(count, <span class="number">4</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;it initializes the museums with the correct values&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      passcardInstance = instance;</span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">museums</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">museum</span>) &#123;</span><br><span class="line"></span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">0</span>], <span class="number">1</span>, <span class="string">&quot;contains the correct id&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">1</span>], <span class="string">&quot;Royal Ontario Museum&quot;</span>, <span class="string">&quot;contains the correct name&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">2</span>], <span class="string">&quot;It is one of the largest museums in North America and the largest in Canada.&quot;</span>, <span class="string">&quot;contains the correct description&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">3</span>], <span class="string">&quot;100 Queens Park, Toronto, ON&quot;</span>, <span class="string">&quot;contains the correct address&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">4</span>], <span class="string">&quot;Mon-Fri, 10a.m.-5:30p.m.&quot;</span>, <span class="string">&quot;contains the correct hours&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">5</span>], <span class="string">&quot;./images/on_royal.jpg&quot;</span>, <span class="string">&quot;contains the correct img path&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">6</span>], <span class="string">&quot;2020-09-15&quot;</span>, <span class="string">&quot;contains the correct expiration date&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">7</span>], <span class="number">10</span>, <span class="string">&quot;contains the correct number of pass cards&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">museums</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">museum</span>) &#123;</span><br><span class="line"></span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">0</span>], <span class="number">2</span>, <span class="string">&quot;contains the correct id&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">1</span>], <span class="string">&quot;Gardiner Museum&quot;</span>, <span class="string">&quot;contains the correct name&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">2</span>], <span class="string">&quot;The collection is made up of two types of ceramics, earthenware, and porcelain.&quot;</span>, <span class="string">&quot;contains the correct description&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">3</span>], <span class="string">&quot;111 Queens Park, Toronto, ON&quot;</span>, <span class="string">&quot;contains the correct address&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">4</span>], <span class="string">&quot;Mon-Fri, 10a.m.-6:00p.m.&quot;</span>, <span class="string">&quot;contains the correct hours&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">5</span>], <span class="string">&quot;./images/gardiner.jpg&quot;</span>, <span class="string">&quot;contains the correct img path&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">6</span>], <span class="string">&quot;2020-10-08&quot;</span>, <span class="string">&quot;contains the correct expiration date&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">7</span>], <span class="number">30</span>, <span class="string">&quot;contains the correct number of pass cards&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">museums</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">museum</span>) &#123;</span><br><span class="line"></span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">0</span>], <span class="number">3</span>, <span class="string">&quot;contains the correct id&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">1</span>], <span class="string">&quot;Art Gallery of Ontario&quot;</span>, <span class="string">&quot;contains the correct name&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">2</span>], <span class="string">&quot;Its permanent collection represents many artistic movements and eras of art history.&quot;</span>, <span class="string">&quot;contains the correct description&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">3</span>], <span class="string">&quot;317 Dundas St W, Toronto, ON&quot;</span>, <span class="string">&quot;contains the correct address&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">4</span>], <span class="string">&quot;Mon-Fri, 10:30a.m.-5p.m.&quot;</span>, <span class="string">&quot;contains the correct hours&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">5</span>], <span class="string">&quot;./images/ago.jpg&quot;</span>, <span class="string">&quot;contains the correct img path&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">6</span>], <span class="string">&quot;2020-11-20&quot;</span>, <span class="string">&quot;contains the correct expiration date&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">7</span>], <span class="number">25</span>, <span class="string">&quot;contains the correct number of pass cards&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">museums</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">museum</span>) &#123;</span><br><span class="line"></span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">0</span>], <span class="number">4</span>, <span class="string">&quot;contains the correct id&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">1</span>], <span class="string">&quot;Textile Museum of Canada&quot;</span>, <span class="string">&quot;contains the correct name&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">2</span>], <span class="string">&quot;It is a museum dedicated to the collection, exhibition, and documentation of textiles.&quot;</span>, <span class="string">&quot;contains the correct description&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">3</span>], <span class="string">&quot;55 Centre Ave, Toronto, ON&quot;</span>, <span class="string">&quot;contains the correct address&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">4</span>], <span class="string">&quot;Mon-Sun, 11a.m.-5p.m.&quot;</span>, <span class="string">&quot;contains the correct hours&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">5</span>], <span class="string">&quot;./images/textile.jpg&quot;</span>, <span class="string">&quot;contains the correct img path&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">6</span>], <span class="string">&quot;2020-12-16&quot;</span>, <span class="string">&quot;contains the correct expiration date&quot;</span>);</span><br><span class="line">      assert.<span class="title function_">equal</span>(museum[<span class="number">7</span>], <span class="number">1</span>, <span class="string">&quot;contains the correct number of pass cards&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The first test checks that the contract was initialized with the correct number of museums by checking the museum count is equal to 4. The next test inspects the values of each museum, ensuring that each museum has the correct id, name, description, address, open hours, image path, expiration date, and the number of pass cards.  </p>
<p>Now let’s run the tests from the command line like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle <span class="built_in">test</span></span></span><br></pre></td></tr></table></figure>
<p>Please notice that you need to exit truffle console and type the above command in the normal console.  </p>
<p>Congratulations! You have passed all the tests so far.</p>
<h3 id="Step3-Model-User-Information-and-Add-Functions"><a href="#Step3-Model-User-Information-and-Add-Functions" class="headerlink" title="Step3 - Model User Information and Add Functions"></a>Step3 - Model User Information and Add Functions</h3><p>We need a way to count the number of pass cards that a user already got, and also keep track of their pass cards information. We can use a mapping to record whether the user got the pass card from a museum with a specified id. Here is how we will model the user information in <code>Passcard.sol</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">contract Passcard &#123;</span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">    // Model the user information</span><br><span class="line">    struct UserInfo &#123;</span><br><span class="line">      uint passcardsCount;</span><br><span class="line">      mapping(uint =&gt; bool) passcardsValid;</span><br><span class="line">      bool exist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We specified that this struct has a <code>passcardsCount</code> of unsigned integer type to count the number of pass cards the user got, and a Solidity mapping <code>passcardsValid</code> to record whether the user got the pass card from the specified museum - the museum has an id of unsigned integer type. Besides, we set a boolean variable <code>exist</code> to help check whether the user exists in the global <code>users</code> mapping, which we will introduce next.  </p>
<p>We need a place to store the <code>UserInfo</code> structure type that we’ve just created. We can do this with a Solidity mapping <code>users</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">contract Passcard &#123;</span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">    // Model the user information</span><br><span class="line">    struct UserInfo &#123;</span><br><span class="line">      uint passcardsCount;</span><br><span class="line">      mapping(uint =&gt; bool) passcardsValid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">    // Read/Write users&#x27; information</span><br><span class="line">    mapping(address =&gt; UserInfo) public users;</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In this case, the key to the mapping is the account address of the user, and the value is a <code>UserInfo</code> structure type that we just defined. This essentially gives us an address-based look up for each user.</p>
<p>Now let’s add the ability to get pass cards for users by adding a “get passcard” function:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">contract Passcard &#123;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  function getPasscard (uint _museumId) public &#123;</span><br><span class="line"></span><br><span class="line">    if (!users[msg.sender].exist) &#123;</span><br><span class="line">      // initialize user information</span><br><span class="line">      users[msg.sender] = UserInfo(&#123;passcardsCount: 0, exist: true&#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // require that the user can&#x27;t get the same pass card twice</span><br><span class="line">      require(!users[msg.sender].passcardsValid[_museumId]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // require a valid museumId</span><br><span class="line">    require(_museumId &gt; 0 &amp;&amp; _museumId &lt;= museumsCount);</span><br><span class="line"></span><br><span class="line">    //require the number of remaining pass cards for the museum is larger than zero</span><br><span class="line">    require(museums[_museumId].count_remain &gt; 0);</span><br><span class="line"></span><br><span class="line">    // record that user got the pass card</span><br><span class="line">    users[msg.sender].passcardsValid[_museumId] = true;</span><br><span class="line"></span><br><span class="line">    // update count of pass cards for that user</span><br><span class="line">    users[msg.sender].passcardsCount += 1;</span><br><span class="line"></span><br><span class="line">    //update the number of remaining pass cards for the museum</span><br><span class="line">    museums[_museumId].count_remain -= 1;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In this <code>getPasscard</code> function, if the user’s account address doesn’t exist in the <code>users</code> mapping, it will initialize the user information by setting <code>passcardsCount</code> to 0 and <code>exist</code> to <code>true</code>.  </p>
<p>The core functionality is as follows: set the boolean for the specified museum id in the mapping <code>passcardsValid</code> to <code>true</code>; increase <code>passcardsCount</code> by 1; decrease the museum’s number of remaining pass cards by 1.  </p>
<p>It also implements require statements that will stop execution if the conditions are not met: first require that the user can’t get the passcard if he&#x2F;she’ve already got a same one; second require that the museum id is valid; third require that the number of the museum’s remaining pass cards is larger than zero.</p>
<p>Next let’s add the ability for users to remove pass cards by adding a “remove passcard” function:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">contract Passcard &#123;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  function removePasscard (uint _museumId) public &#123;</span><br><span class="line">    // require the user exists in mapping and got passcards before</span><br><span class="line">    require(users[msg.sender].exist);</span><br><span class="line"></span><br><span class="line">    // require that the user has the passcard with id _museumId</span><br><span class="line">    require(users[msg.sender].passcardsValid[_museumId]);</span><br><span class="line"></span><br><span class="line">    // require a valid museumId</span><br><span class="line">    require(_museumId &gt; 0 &amp;&amp; _museumId &lt;= museumsCount);</span><br><span class="line"></span><br><span class="line">    // record that user removes the passcard</span><br><span class="line">    users[msg.sender].passcardsValid[_museumId] = false;</span><br><span class="line"></span><br><span class="line">    // update count of passcards for that user</span><br><span class="line">    users[msg.sender].passcardsCount -= 1;</span><br><span class="line"></span><br><span class="line">    //update the number of remaining pass cards for the museum</span><br><span class="line">    museums[_museumId].count_remain += 1;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The core functionality of this <code>removePasscard</code> function is as follows: set the boolean for the specified museum id in the mapping <code>passcardsValid</code> to be <code>false</code>, decrease <code>passcardsCount</code> by 1, and increase the museum’s number of remaining pass cards by 1.  </p>
<p>It also implements require statements that will stop execution if the conditions are not met: first require that the user exists in <code>users</code> mapping and got passcards before; second require that the user has the pass card with the specified museum id; third require that the museum id is valid.  </p>
<p>Now let’s add the function to help check whether the user has the pass card of a specified museum:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">contract Passcard &#123;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  //check if the user has the pass card of the museum with id _museumId</span><br><span class="line">  function getPcValid (uint _museumId) public returns (bool) &#123;</span><br><span class="line">    return (users[msg.sender].passcardsValid[_museumId]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We set this function to be public since it’s helpful to call it outside the contract.</p>
<p>At this point, your contract code should look like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.5.16;</span><br><span class="line"></span><br><span class="line">contract Passcard &#123;</span><br><span class="line"></span><br><span class="line">  //Model a Museum</span><br><span class="line">  struct Museum &#123;</span><br><span class="line">    uint id;</span><br><span class="line">    string name;</span><br><span class="line">    string description;</span><br><span class="line">    string addr;</span><br><span class="line">    string hour;</span><br><span class="line">    string imgsrc;</span><br><span class="line">    string expire_date;</span><br><span class="line">    uint count_remain;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Model the user information</span><br><span class="line">  struct UserInfo &#123;</span><br><span class="line">    uint passcardsCount;</span><br><span class="line">    mapping(uint =&gt; bool) passcardsValid;</span><br><span class="line">    bool exist;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //Read/Write museums&#x27; information</span><br><span class="line">  mapping(uint =&gt; Museum) public museums;</span><br><span class="line"></span><br><span class="line">  //keep track of museum counts</span><br><span class="line">  uint public museumsCount;</span><br><span class="line"></span><br><span class="line">  // Read/Write users&#x27; information</span><br><span class="line">  mapping(address =&gt; UserInfo) public users;</span><br><span class="line"></span><br><span class="line">  //Constructor</span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    //add mock data</span><br><span class="line">    addMuseum(&quot;Royal Ontario Museum&quot;,</span><br><span class="line">    &quot;It is one of the largest museums in North America and the largest in Canada.&quot;,</span><br><span class="line">    &quot;100 Queens Park, Toronto, ON&quot;, &quot;Mon-Fri, 10a.m.-5:30p.m.&quot;, &quot;./images/on_royal.jpg&quot;, &quot;2020-09-15&quot;, 10);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Gardiner Museum&quot;,</span><br><span class="line">    &quot;The collection is made up of two types of ceramics, earthenware, and porcelain.&quot;,</span><br><span class="line">    &quot;111 Queens Park, Toronto, ON&quot;, &quot;Mon-Fri, 10a.m.-6:00p.m.&quot;, &quot;./images/gardiner.jpg&quot;, &quot;2020-10-08&quot;, 30);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Art Gallery of Ontario&quot;,</span><br><span class="line">    &quot;Its permanent collection represents many artistic movements and eras of art history.&quot;,</span><br><span class="line">    &quot;317 Dundas St W, Toronto, ON&quot;, &quot;Mon-Fri, 10:30a.m.-5p.m.&quot;, &quot;./images/ago.jpg&quot;, &quot;2020-11-20&quot;, 25);</span><br><span class="line"></span><br><span class="line">    addMuseum(&quot;Textile Museum of Canada&quot;,</span><br><span class="line">    &quot;It is a museum dedicated to the collection, exhibition, and documentation of textiles.&quot;,</span><br><span class="line">    &quot;55 Centre Ave, Toronto, ON&quot;, &quot;Mon-Sun, 11a.m.-5p.m.&quot;, &quot;./images/textile.jpg&quot;, &quot;2020-12-16&quot;, 1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //function for adding museum</span><br><span class="line">  function addMuseum (string memory _name, string memory _description,</span><br><span class="line">    string memory _addr, string memory _hours, string memory _imgsrc,</span><br><span class="line">    string memory _date, uint _count) private &#123;</span><br><span class="line">      museumsCount += 1;</span><br><span class="line">      museums[museumsCount] = Museum(museumsCount, _name, _description, _addr, _hours,</span><br><span class="line">        _imgsrc, _date, _count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  function getPasscard (uint _museumId) public &#123;</span><br><span class="line"></span><br><span class="line">    if (!users[msg.sender].exist) &#123;</span><br><span class="line">      // initialize user information</span><br><span class="line">      users[msg.sender] = UserInfo(&#123;passcardsCount: 0, exist: true&#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // require that the user can&#x27;t get the same pass card twice</span><br><span class="line">      require(!users[msg.sender].passcardsValid[_museumId]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // require a valid museumId</span><br><span class="line">    require(_museumId &gt; 0 &amp;&amp; _museumId &lt;= museumsCount);</span><br><span class="line"></span><br><span class="line">    //require the number of remaining pass cards for the museum is larger than zero</span><br><span class="line">    require(museums[_museumId].count_remain &gt; 0);</span><br><span class="line"></span><br><span class="line">    // record that user got the pass card</span><br><span class="line">    users[msg.sender].passcardsValid[_museumId] = true;</span><br><span class="line"></span><br><span class="line">    // update count of pass cards for that user</span><br><span class="line">    users[msg.sender].passcardsCount += 1;</span><br><span class="line"></span><br><span class="line">    //update the number of remaining pass cards for the museum</span><br><span class="line">    museums[_museumId].count_remain -= 1;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function removePasscard (uint _museumId) public &#123;</span><br><span class="line">    // require the user exists in mapping and got passcards before</span><br><span class="line">    require(users[msg.sender].exist);</span><br><span class="line"></span><br><span class="line">    // require that the user has the passcard with id _museumId</span><br><span class="line">    require(users[msg.sender].passcardsValid[_museumId]);</span><br><span class="line"></span><br><span class="line">    // require a valid museumId</span><br><span class="line">    require(_museumId &gt; 0 &amp;&amp; _museumId &lt;= museumsCount);</span><br><span class="line"></span><br><span class="line">    // record that user removes the passcard</span><br><span class="line">    users[msg.sender].passcardsValid[_museumId] = false;</span><br><span class="line"></span><br><span class="line">    // update count of passcards for that user</span><br><span class="line">    users[msg.sender].passcardsCount -= 1;</span><br><span class="line"></span><br><span class="line">    //update the number of remaining pass cards for the museum</span><br><span class="line">    museums[_museumId].count_remain += 1;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //check if the user has the pass card of the museum with id _museumId</span><br><span class="line">  function getPcValid (uint _museumId) public returns (bool) &#123;</span><br><span class="line">    return (users[msg.sender].passcardsValid[_museumId]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now let’s migrate our contract like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle migrate --reset</span></span><br></pre></td></tr></table></figure>

<h3 id="Step4-Test-User-Model-and-Functions"><a href="#Step4-Test-User-Model-and-Functions" class="headerlink" title="Step4 - Test User Model and Functions"></a>Step4 - Test User Model and Functions</h3><p>Now let’s add some tests to our <code>passcard.js</code> test file:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">contract</span>(<span class="string">&quot;Passcard&quot;</span>, <span class="keyword">function</span>(<span class="params">accounts</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;allows a user to get and remove a pass card&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      passcardInstance = instance;</span><br><span class="line">      museumId = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">getPasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">receipt</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">users</span>(accounts[<span class="number">0</span>]);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">userinfo</span>) &#123;</span><br><span class="line">      assert.<span class="title function_">equal</span>(userinfo.<span class="property">passcardsCount</span>, <span class="number">1</span>, <span class="string">&quot;increments the user&#x27;s pass card count&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="property">getPcValid</span>.<span class="title function_">call</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">valid_status</span>)&#123;</span><br><span class="line">      assert.<span class="title function_">equal</span>(valid_status, <span class="literal">true</span>, <span class="string">&quot;the user got the pass card of museum1&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">removePasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">receipt</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">users</span>(accounts[<span class="number">0</span>]);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">userinfo</span>) &#123;</span><br><span class="line">      assert.<span class="title function_">equal</span>(userinfo.<span class="property">passcardsCount</span>, <span class="number">0</span>, <span class="string">&quot;deducts the user&#x27;s pass card count&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="property">getPcValid</span>.<span class="title function_">call</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">valid_status</span>) &#123;</span><br><span class="line">      assert.<span class="title function_">equal</span>(valid_status, <span class="literal">false</span>, <span class="string">&quot;the user removed the pass card of museum1&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Here we test several things: the <code>getPasscard</code> function increments the number of pass cards for the user, and sets value for “museumId” in the user’s <code>passcardsValid</code> mapping to be <code>true</code>; the <code>removePasscard</code> function decreases the number of pass cards for the user, and sets corresponding value in the <code>passcardsValid</code> mapping to be <code>false</code>. Also it tests the user is added to the <code>users</code> mapping.</p>
<p>Now let’s write a test to ensure the count of remaining pass cards of a museum varies when the user gets one from the museum or removes the one he&#x2F;she had:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;the number of remaining pass cards for museums varies when the user gets one or removes one&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">    passcardInstance = instance;</span><br><span class="line">    museumId = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">getPasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">receipt</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">museums</span>(museumId);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">museum</span>) &#123;</span><br><span class="line">    assert.<span class="title function_">equal</span>(museum[<span class="number">7</span>], <span class="number">9</span>, <span class="string">&quot;decrease the count of pass cards left for museum1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">removePasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">receipt</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">museums</span>(museumId);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">museum</span>) &#123;</span><br><span class="line">    assert.<span class="title function_">equal</span>(museum[<span class="number">7</span>], <span class="number">10</span>, <span class="string">&quot;increment the count of pass cards left for museum1&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Let’s write a test to ensure that our <code>getPasscard</code> function throws an exception for invalid museum id:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// write a test to ensure that our getPasscard function throws an exception for invalid museum id:</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&quot;throws an exception for invalid museum id in getPasscard&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">    passcardInstance = instance;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">getPasscard</span>(<span class="number">99</span>, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;)</span><br><span class="line">  &#125;).<span class="title function_">then</span>(assert.<span class="property">fail</span>).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="title function_">assert</span>(error.<span class="property">message</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;revert&#x27;</span>) &gt;= <span class="number">0</span>, <span class="string">&quot;error message must contain revert&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Also let’s write a test to ensure that our <code>getPasscard</code> function throws an exception for getting a passcard if the user already has a same one:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;throws an exception for getting same passcard twice&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">    passcardInstance = instance;</span><br><span class="line">    museumId = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">getPasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">receipt</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">users</span>(accounts[<span class="number">1</span>]);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">userinfo</span>) &#123;</span><br><span class="line">    assert.<span class="title function_">equal</span>(userinfo.<span class="property">passcardsCount</span>, <span class="number">1</span>, <span class="string">&quot;gets first passcard&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="property">getPcValid</span>.<span class="title function_">call</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">valid_status</span>)&#123;</span><br><span class="line">    assert.<span class="title function_">equal</span>(valid_status, <span class="literal">true</span>, <span class="string">&quot;passcard of museum2 is valid&quot;</span>);</span><br><span class="line">    <span class="comment">// Try to get same passcard again</span></span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">getPasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(assert.<span class="property">fail</span>).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="title function_">assert</span>(error.<span class="property">message</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;revert&#x27;</span>) &gt;= <span class="number">0</span>, <span class="string">&quot;error message must contain revert&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Let’s write a test to ensure that our <code>getPasscard</code> function throws an exception when the  count of remaining pass cards is zero for a museum but the user still tries to get one:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;throws an exception when the count of remaining pass cards is zero for a museum but the user still tries to get one&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">    passcardInstance = instance;</span><br><span class="line">    museumId = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">getPasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">receipt</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">getPasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(assert.<span class="property">fail</span>).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="title function_">assert</span>(error.<span class="property">message</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;revert&#x27;</span>) &gt;= <span class="number">0</span>, <span class="string">&quot;error message must contain revert&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Then let’s write a test to ensure that our <code>removePasscard</code> function throws an exception for invalid museum id:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;throws an exception for invalid museum id in removePasscard&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">    passcardInstance = instance;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">removePasscard</span>(<span class="number">99</span>, &#123; <span class="attr">from</span>: accounts[<span class="number">1</span>] &#125;)</span><br><span class="line">  &#125;).<span class="title function_">then</span>(assert.<span class="property">fail</span>).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="title function_">assert</span>(error.<span class="property">message</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;revert&#x27;</span>) &gt;= <span class="number">0</span>, <span class="string">&quot;error message must contain revert&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Also let’s write a test to ensure that our <code>removePasscard</code> function throws an exception when a user tries to remove a pass card that he&#x2F;she doesn’t have:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;throws an exception for users removing invalid pass cards&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">    passcardInstance = instance;</span><br><span class="line">    museumId = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">removePasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">2</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(assert.<span class="property">fail</span>).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="title function_">assert</span>(error.<span class="property">message</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;revert&#x27;</span>) &gt;= <span class="number">0</span>, <span class="string">&quot;error message must contain revert&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Now let’s run the tests from the command line like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle <span class="built_in">test</span></span></span><br></pre></td></tr></table></figure>

<p>Congratulations! You have passed all the 9 tests so far and we are ready to move on to the client-side.</p>
<h3 id="Step5-Client-Side-Application"><a href="#Step5-Client-Side-Application" class="headerlink" title="Step5 - Client-Side Application"></a>Step5 - Client-Side Application</h3><p>Now let’s start building the client-side application that will talk to our smart contract.  </p>
<p>Go ahead and replace all of the content of your <code>index.html</code> file inside <code>src</code> directory with these lines of code:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Museum Pass Card<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- customize --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/museum.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;web_title&quot;</span>&gt;</span>Museum Pass Card Promotions<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;web_note&quot;</span>&gt;</span>Get the pass card and enjoy one-day free trip!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;loader&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row_museum&quot;</span> <span class="attr">id</span>=<span class="string">&quot;card_museums&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;get_museum&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;count_title&quot;</span>&gt;</span>Your pass cards: <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span> so far<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;accountAddress&quot;</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span>12345<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row_museum&quot;</span> <span class="attr">id</span>=<span class="string">&quot;user_cards&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- jQuery (necessary for Bootstrap&#x27;s JavaScript plugins) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/web3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/truffle-contract.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now let’s create a new CSS file named with <code>museum.css</code> in our <code>src/css</code> directory, and add these lines of code:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.web_title</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.web_note</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hr &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">0px</span> <span class="number">10px</span> <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.row_museum</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card_museum</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">49%</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">220px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#3399ff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card_museum</span> <span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">38%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">99%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> <span class="selector-class">.image</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">95%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#cce6ff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16px</span> <span class="number">0px</span> <span class="number">0px</span> <span class="number">16px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.image</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">16px</span> <span class="number">0px</span> <span class="number">0px</span> <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card_museum</span> <span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">62%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> <span class="selector-class">.card-title</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> <span class="selector-class">.card-button</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1a8cff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card-button</span> <span class="selector-id">#amount</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0px</span> <span class="number">3px</span> <span class="number">0px</span> <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card-button</span> <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">4%</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20%</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> <span class="selector-class">.card-note</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1a8cff</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card-note</span> <span class="selector-id">#date</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.count_title</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user_card</span> &#123;</span><br><span class="line">  <span class="attribute">border-color</span>: <span class="number">#33cc33</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user_card</span> <span class="selector-class">.left</span> <span class="selector-class">.image</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#c2f0c2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user_card</span> <span class="selector-class">.right</span> <span class="selector-class">.card-note</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#29a329</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user_card</span> <span class="selector-class">.right</span> <span class="selector-class">.card-button</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">font-weight</span>: bolder;</span><br><span class="line">  <span class="attribute">font-size</span>: large;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#29a329</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0px</span> <span class="number">30px</span> <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, replace all of the content of your <code>app.js</code> file in the <code>src/js</code> directory with these lines of code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">App</span> = &#123;</span><br><span class="line">  <span class="attr">web3Provider</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">contracts</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">account</span>: <span class="string">&#x27;0x0&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">init</span>: <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title class_">App</span>.<span class="title function_">initWeb3</span>();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">initWeb3</span>: <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">ethereum</span>) &#123;</span><br><span class="line">      <span class="title class_">App</span>.<span class="property">web3Provider</span> = <span class="variable language_">window</span>.<span class="property">ethereum</span>;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="property">ethereum</span>.<span class="title function_">enable</span>();</span><br><span class="line">      web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(<span class="title class_">App</span>.<span class="property">web3Provider</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">App</span>.<span class="title function_">initContract</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title class_">App</span>.<span class="property">web3Provider</span> = <span class="keyword">new</span> <span class="title class_">Web3</span>.<span class="property">providers</span>.<span class="title class_">HttpProvider</span>(<span class="string">&#x27;http://localhost:7545&#x27;</span>);</span><br><span class="line">      web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(<span class="title class_">App</span>.<span class="property">web3Provider</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">App</span>.<span class="title function_">initContract</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">initContract</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">getJSON</span>(<span class="string">&quot;Passcard.json&quot;</span>, <span class="keyword">function</span>(<span class="params">passcard</span>) &#123;</span><br><span class="line">      <span class="comment">// Instantiate a new truffle contract from the artifact</span></span><br><span class="line">      <span class="title class_">App</span>.<span class="property">contracts</span>.<span class="property">Passcard</span> = <span class="title class_">TruffleContract</span>(passcard);</span><br><span class="line">      <span class="comment">// Connect provider to interact with contract</span></span><br><span class="line">      <span class="title class_">App</span>.<span class="property">contracts</span>.<span class="property">Passcard</span>.<span class="title function_">setProvider</span>(<span class="title class_">App</span>.<span class="property">web3Provider</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">App</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">getPasscard</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> museumId = <span class="built_in">parseInt</span>(e.<span class="property">target</span>.<span class="property">id</span>.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">    <span class="title class_">App</span>.<span class="property">contracts</span>.<span class="property">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> instance.<span class="title function_">getPasscard</span>(museumId, &#123; <span class="attr">from</span>: <span class="title class_">App</span>.<span class="property">account</span> &#125;);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">      <span class="comment">// Wait for votes to update</span></span><br><span class="line">      $(<span class="string">&quot;#content&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">      $(<span class="string">&quot;#loader&quot;</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">removePasscard</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> museumId = <span class="built_in">parseInt</span>(e.<span class="property">target</span>.<span class="property">id</span>.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">    <span class="title class_">App</span>.<span class="property">contracts</span>.<span class="property">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> instance.<span class="title function_">removePasscard</span>(museumId, &#123; <span class="attr">from</span>: <span class="title class_">App</span>.<span class="property">account</span> &#125;);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">      <span class="comment">// Wait for votes to update</span></span><br><span class="line">      $(<span class="string">&quot;#content&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">      $(<span class="string">&quot;#loader&quot;</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">render</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> passcardInstance;</span><br><span class="line">    <span class="keyword">let</span> loader = $(<span class="string">&quot;#loader&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> content = $(<span class="string">&quot;#content&quot;</span>);</span><br><span class="line"></span><br><span class="line">    loader.<span class="title function_">show</span>();</span><br><span class="line">    content.<span class="title function_">hide</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load account data</span></span><br><span class="line">    web3.<span class="property">eth</span>.<span class="title function_">getCoinbase</span>(<span class="keyword">function</span>(<span class="params">err, account</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title class_">App</span>.<span class="property">account</span> = account;</span><br><span class="line">        $(<span class="string">&quot;#accountAddress&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;Your Account: &quot;</span> + account);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load contract data</span></span><br><span class="line">    <span class="title class_">App</span>.<span class="property">contracts</span>.<span class="property">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      passcardInstance = instance;</span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="title function_">museumsCount</span>();</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">museumsCount</span>) &#123;</span><br><span class="line">      <span class="comment">// console.log(`museumsCount: $&#123;museumsCount&#125;`)</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> museums_promises = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= museumsCount; i++) &#123;</span><br><span class="line">        museums_promises.<span class="title function_">push</span>(passcardInstance.<span class="title function_">museums</span>(i));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> museums_array = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(museums_promises);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> museumsListing = $(<span class="string">&quot;#card_museums&quot;</span>);</span><br><span class="line">      museumsListing.<span class="title function_">empty</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; museumsCount; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> museum = museums_array[i];</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> id = museum[<span class="number">0</span>];</span><br><span class="line">          <span class="keyword">let</span> name = museum[<span class="number">1</span>];</span><br><span class="line">          <span class="keyword">let</span> description = museum[<span class="number">2</span>];</span><br><span class="line">          <span class="keyword">let</span> addr = museum[<span class="number">3</span>];</span><br><span class="line">          <span class="keyword">let</span> hour = museum[<span class="number">4</span>];</span><br><span class="line">          <span class="keyword">let</span> imgsrc = museum[<span class="number">5</span>];</span><br><span class="line">          <span class="keyword">let</span> expire_date = museum[<span class="number">6</span>];</span><br><span class="line">          <span class="keyword">let</span> count_remain = museum[<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Render museums in DOM</span></span><br><span class="line">          <span class="keyword">let</span> card_museum = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">          card_museum.<span class="property">className</span> = <span class="string">&quot;card_museum&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> leftcol = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">          leftcol.<span class="property">className</span> = <span class="string">&quot;left&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> imgcontainer = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">          imgcontainer.<span class="property">className</span> = <span class="string">&quot;image&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">          img.<span class="property">src</span> = imgsrc;</span><br><span class="line">          img.<span class="property">alt</span> = name;</span><br><span class="line"></span><br><span class="line">          imgcontainer.<span class="title function_">appendChild</span>(img);</span><br><span class="line">          leftcol.<span class="title function_">appendChild</span>(imgcontainer);</span><br><span class="line">          card_museum.<span class="title function_">appendChild</span>(leftcol);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> rightcol = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">          rightcol.<span class="property">className</span> = <span class="string">&quot;right&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> card_title = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;h5&quot;</span>);</span><br><span class="line">          card_title.<span class="property">className</span> = <span class="string">&quot;card-title&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> title_text = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;strong&quot;</span>);</span><br><span class="line">          title_text.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(name));</span><br><span class="line"></span><br><span class="line">          card_title.<span class="title function_">appendChild</span>(title_text);</span><br><span class="line">          rightcol.<span class="title function_">appendChild</span>(card_title);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> card_desc = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">          card_desc.<span class="property">className</span> = <span class="string">&quot;card-text&quot;</span>;</span><br><span class="line">          card_desc.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(description));</span><br><span class="line">          rightcol.<span class="title function_">appendChild</span>(card_desc);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> card_addr_hour = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">          card_addr_hour.<span class="property">className</span> = <span class="string">&quot;card-text&quot;</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> card_addr = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;strong&quot;</span>);</span><br><span class="line">          card_addr.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;Address: &quot;</span>));</span><br><span class="line">          <span class="keyword">let</span> addr_text = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(addr);</span><br><span class="line">          <span class="keyword">let</span> br = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;br&quot;</span>);</span><br><span class="line">          card_addr_hour.<span class="title function_">appendChild</span>(card_addr);</span><br><span class="line">          card_addr_hour.<span class="title function_">appendChild</span>(addr_text);</span><br><span class="line">          card_addr_hour.<span class="title function_">appendChild</span>(br);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> card_hour = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;strong&quot;</span>);</span><br><span class="line">          card_hour.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;Hours: &quot;</span>));</span><br><span class="line">          <span class="keyword">let</span> hour_text = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(hour);</span><br><span class="line">          card_addr_hour.<span class="title function_">appendChild</span>(card_hour);</span><br><span class="line">          card_addr_hour.<span class="title function_">appendChild</span>(hour_text);</span><br><span class="line"></span><br><span class="line">          rightcol.<span class="title function_">appendChild</span>(card_addr_hour);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> card_note = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">          card_note.<span class="property">className</span> = <span class="string">&quot;card-text card-note&quot;</span>;</span><br><span class="line">          card_note.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;Pass card will be expired by &quot;</span>));</span><br><span class="line">          <span class="keyword">let</span> date_text = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;span&quot;</span>);</span><br><span class="line">          date_text.<span class="title function_">setAttribute</span>(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;date&quot;</span>);</span><br><span class="line">          date_text.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(expire_date));</span><br><span class="line">          card_note.<span class="title function_">appendChild</span>(date_text);</span><br><span class="line"></span><br><span class="line">          rightcol.<span class="title function_">appendChild</span>(card_note);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> card_button = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">          card_button.<span class="property">className</span> = <span class="string">&quot;card-button&quot;</span>;</span><br><span class="line">          card_button.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;only &quot;</span>));</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> amount = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;span&quot;</span>);</span><br><span class="line">          amount.<span class="title function_">setAttribute</span>(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;amount&quot;</span>);</span><br><span class="line">          amount.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(count_remain));</span><br><span class="line"></span><br><span class="line">          card_button.<span class="title function_">appendChild</span>(amount);</span><br><span class="line">          card_button.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot; pass cards left !&quot;</span>));</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> button_valid = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">          button_valid.<span class="title function_">setAttribute</span>(<span class="string">&quot;id&quot;</span>, <span class="string">`<span class="subst">$&#123;id&#125;</span>-valid`</span>);</span><br><span class="line">          button_valid.<span class="property">type</span> = <span class="string">&quot;button&quot;</span>;</span><br><span class="line">          button_valid.<span class="property">className</span> = <span class="string">&quot;btn btn-primary&quot;</span>;</span><br><span class="line">          button_valid.<span class="property">onclick</span> = <span class="title class_">App</span>.<span class="property">getPasscard</span>;</span><br><span class="line">          <span class="keyword">if</span> (count_remain &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            button_valid.<span class="property">disabled</span> = <span class="literal">true</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            button_valid.<span class="property">disabled</span> = <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          button_valid.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;Get !&quot;</span>));</span><br><span class="line"></span><br><span class="line">          card_button.<span class="title function_">appendChild</span>(button_valid);</span><br><span class="line"></span><br><span class="line">          rightcol.<span class="title function_">appendChild</span>(card_button);</span><br><span class="line"></span><br><span class="line">          card_museum.<span class="title function_">appendChild</span>(rightcol);</span><br><span class="line"></span><br><span class="line">          museumsListing.<span class="title function_">append</span>(card_museum);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> passcardInstance.<span class="property">users</span>.<span class="title function_">call</span>(<span class="title class_">App</span>.<span class="property">account</span>);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">userinfo</span>)&#123;</span><br><span class="line">      <span class="keyword">let</span> passcardsCount = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;count&quot;</span>);</span><br><span class="line">      passcardsCount.<span class="property">innerHTML</span> = userinfo[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// console.log(`passcardsCount: $&#123;userinfo[0]&#125;`)</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> museumsCount = <span class="keyword">await</span> passcardInstance.<span class="title function_">museumsCount</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> boolean_promises = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= museumsCount; i++) &#123;</span><br><span class="line">        boolean_promises.<span class="title function_">push</span>(passcardInstance.<span class="property">getPcValid</span>.<span class="title function_">call</span>(i, &#123;<span class="attr">from</span>: <span class="title class_">App</span>.<span class="property">account</span>&#125;));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> boolean_array = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(boolean_promises);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// console.log(boolean_array)</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> museum_promises = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= museumsCount; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (boolean_array[i - <span class="number">1</span>]) &#123;</span><br><span class="line">          museum_promises.<span class="title function_">push</span>(passcardInstance.<span class="title function_">museums</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> museum_array = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(museum_promises);</span><br><span class="line">      <span class="keyword">let</span> museum_array_length = museum_array.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> userCardsListing = $(<span class="string">&quot;#user_cards&quot;</span>);</span><br><span class="line">      userCardsListing.<span class="title function_">empty</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// console.log(museum_array)</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; museum_array_length; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> museum = museum_array[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> museumId = museum[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> name = museum[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> description = museum[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">let</span> addr = museum[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">let</span> hour = museum[<span class="number">4</span>];</span><br><span class="line">        <span class="keyword">let</span> imgsrc = museum[<span class="number">5</span>]</span><br><span class="line">        <span class="keyword">let</span> expire_date = museum[<span class="number">6</span>];</span><br><span class="line">        <span class="keyword">let</span> count_remain = museum[<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// disable buttons in museum cards if the user already got the pass card</span></span><br><span class="line">        <span class="keyword">let</span> button_will_disable = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">`<span class="subst">$&#123;museumId&#125;</span>-valid`</span>);</span><br><span class="line">        <span class="keyword">if</span> (button_will_disable) &#123;</span><br><span class="line">          button_will_disable.<span class="property">disabled</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Render museums in DOM</span></span><br><span class="line">        <span class="keyword">let</span> card_museum = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">        card_museum.<span class="property">className</span> = <span class="string">&quot;user_card card_museum&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> leftcol = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">        leftcol.<span class="property">className</span> = <span class="string">&quot;left&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> imgcontainer = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">        imgcontainer.<span class="property">className</span> = <span class="string">&quot;image&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">        img.<span class="property">src</span> = imgsrc;</span><br><span class="line">        img.<span class="property">alt</span> = name;</span><br><span class="line"></span><br><span class="line">        imgcontainer.<span class="title function_">appendChild</span>(img);</span><br><span class="line">        leftcol.<span class="title function_">appendChild</span>(imgcontainer);</span><br><span class="line">        card_museum.<span class="title function_">appendChild</span>(leftcol);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> rightcol = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">        rightcol.<span class="property">className</span> = <span class="string">&quot;right&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> card_title = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;h5&quot;</span>);</span><br><span class="line">        card_title.<span class="property">className</span> = <span class="string">&quot;card-title&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> title_text = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;strong&quot;</span>);</span><br><span class="line">        title_text.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(name));</span><br><span class="line"></span><br><span class="line">        card_title.<span class="title function_">appendChild</span>(title_text);</span><br><span class="line">        rightcol.<span class="title function_">appendChild</span>(card_title);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> card_desc = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">        card_desc.<span class="property">className</span> = <span class="string">&quot;card-text&quot;</span>;</span><br><span class="line">        card_desc.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(description));</span><br><span class="line">        rightcol.<span class="title function_">appendChild</span>(card_desc);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> card_addr_hour = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">        card_addr_hour.<span class="property">className</span> = <span class="string">&quot;card-text&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> card_addr = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;strong&quot;</span>);</span><br><span class="line">        card_addr.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;Address: &quot;</span>));</span><br><span class="line">        <span class="keyword">let</span> addr_text = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(addr);</span><br><span class="line">        <span class="keyword">let</span> br = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;br&quot;</span>);</span><br><span class="line">        card_addr_hour.<span class="title function_">appendChild</span>(card_addr);</span><br><span class="line">        card_addr_hour.<span class="title function_">appendChild</span>(addr_text);</span><br><span class="line">        card_addr_hour.<span class="title function_">appendChild</span>(br);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> card_hour = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;strong&quot;</span>);</span><br><span class="line">        card_hour.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;Hours: &quot;</span>));</span><br><span class="line">        <span class="keyword">let</span> hour_text = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(hour);</span><br><span class="line">        card_addr_hour.<span class="title function_">appendChild</span>(card_hour);</span><br><span class="line">        card_addr_hour.<span class="title function_">appendChild</span>(hour_text);</span><br><span class="line"></span><br><span class="line">        rightcol.<span class="title function_">appendChild</span>(card_addr_hour);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> card_note = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">        card_note.<span class="property">className</span> = <span class="string">&quot;card-text card-note&quot;</span>;</span><br><span class="line">        card_note.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;Pass card will be expired by &quot;</span>));</span><br><span class="line">        <span class="keyword">let</span> date_text = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;span&quot;</span>);</span><br><span class="line">        date_text.<span class="title function_">setAttribute</span>(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;date&quot;</span>);</span><br><span class="line">        date_text.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(expire_date));</span><br><span class="line">        card_note.<span class="title function_">appendChild</span>(date_text);</span><br><span class="line"></span><br><span class="line">        rightcol.<span class="title function_">appendChild</span>(card_note);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> enjoy_text = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">        enjoy_text.<span class="property">className</span> = <span class="string">&quot;card-button&quot;</span>;</span><br><span class="line">        enjoy_text.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;ENJOY !&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> button_remove = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">        button_remove.<span class="title function_">setAttribute</span>(<span class="string">&quot;id&quot;</span>, <span class="string">`<span class="subst">$&#123;museumId&#125;</span>-remove`</span>);</span><br><span class="line">        button_remove.<span class="property">type</span> = <span class="string">&quot;button&quot;</span>;</span><br><span class="line">        button_remove.<span class="property">className</span> = <span class="string">&quot;btn btn-danger&quot;</span>;</span><br><span class="line">        button_remove.<span class="property">onclick</span> = <span class="title class_">App</span>.<span class="property">removePasscard</span>;</span><br><span class="line">        button_remove.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&quot;Remove&quot;</span>));</span><br><span class="line"></span><br><span class="line">        enjoy_text.<span class="title function_">appendChild</span>(button_remove);</span><br><span class="line"></span><br><span class="line">        rightcol.<span class="title function_">appendChild</span>(enjoy_text);</span><br><span class="line"></span><br><span class="line">        card_museum.<span class="title function_">appendChild</span>(rightcol);</span><br><span class="line"></span><br><span class="line">        userCardsListing.<span class="title function_">append</span>(card_museum);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      loader.<span class="title function_">hide</span>();</span><br><span class="line">      content.<span class="title function_">show</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(error);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  $(<span class="variable language_">window</span>).<span class="title function_">load</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">App</span>.<span class="title function_">init</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>web3.js</code> is a javascript library that allows our client-side application to talk to the blockchain. We configure web3 inside the <code>initWeb3</code> function.  </p>
<p>In the render function, we fetch the user’s account address, museums’ information, the number of users’ pass cards and detailed information of users’ pass cards from the smart contract to display them at the frontend, and also we add “Get !” and “Remove” buttons on pass cards to invoke functions: <code>getPasscard</code> will be invoked when users click “Get !” buttons, and <code>removePasscard</code> will be invoked when users click “Remove” buttons.  </p>
<p>Now let’s view the client-side application in the browser. First, make sure that you’ve migrated your contracts like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle migrate --reset</span></span><br></pre></td></tr></table></figure>

<p>Next, start your development server from the command line like this:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm run dev</span></span><br></pre></td></tr></table></figure>

<p>This should automatically open a new browser window with your client-side application. Now your front-end application should look like this:</p>
<p><img data-src="/images/tut_img/metamask.png"></p>
<p>Notice that your application says “Loading…”. That’s because we’re not logged in to the blockchain yet. Please firstly enter your password to MetaMask and login MetaMask.  </p>
<p>In order to connect to the blockchain, we need to import one of the accounts from Ganache into Metamask:<br>In Metamask, select <code>Import Account</code>, copy the private key of the first account in Ganache and paste it in the corresponding area of Metamask.  </p>
<p><img data-src="/images/tut_img/import.png"></p>
<p>Make sure you are in <code>HTTP://127.0.0.1:7545</code> network.  </p>
<p>Then refresh the page and confirm the connection.  </p>
<p><img data-src="/images/tut_img/connect.png"></p>
<p>Once you’re connected with Metamask, you should see all of the contract and account data loaded.</p>
<p><img data-src="/images/tut_img/home.png"></p>
<p>Go ahead and try to get and remove pass cards. Once you do, you should see Metamask confirmations pop up like this:</p>
<p><img data-src="/images/tut_img/transaction.png"></p>
<p>Once you click “Confirm”, you’ve successfully completed a transaction in the local blockchain! You’ll still see a loading screen. For now, you’ll have to refresh the page to see the pass card you’ve got&#x2F;removed, the changed number of remaining pass cards for that museum, and the changed number of your pass cards. We’ll implement the functionality to update the webpage automatically in the next section.</p>
<h3 id="Step5-Watch-Events"><a href="#Step5-Watch-Events" class="headerlink" title="Step5 - Watch Events"></a>Step5 - Watch Events</h3><p>The very last step in this tutorial is to trigger an event whenever the user get or remove a pass card. This will allow us to update our client-side application automatically.  </p>
<p>Let’s start by declaring a “get passcard” event in our contract like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">contract Election &#123;</span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">    event getPcEvent (</span><br><span class="line">        uint indexed _museumId</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now we can trigger this “get passcard” event inside our <code>getPasscard</code> function like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function getPasscard (uint _museumId) public &#123;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  /*direct automatically after getting passcard*/</span><br><span class="line">  emit getPcEvent(_museumId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Also let’s declare a “remove passcard” event in our contract:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">contract Election &#123;</span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">    event removePcEvent (</span><br><span class="line">        uint indexed _museumId</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And we can trigger this “remove passcard” event inside our <code>removePasscard</code> function like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function removePasscard (uint _museumId) public &#123;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  /*direct automatically after getting passcard*/</span><br><span class="line">  emit removePcEvent(_museumId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now that we’ve updated our contract, we should re-run our migrations:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle migrate --reset</span></span><br></pre></td></tr></table></figure>

<p>We can also add a test to our <code>passcard.js</code> test file to check for these events like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;the getPcEvent and removePcEvent is triggered correcly&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">    passcardInstance = instance;</span><br><span class="line">    museumId = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">getPasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">receipt</span>) &#123;</span><br><span class="line">    assert.<span class="title function_">equal</span>(receipt.<span class="property">logs</span>.<span class="property">length</span>, <span class="number">1</span>, <span class="string">&quot;an getPc event was triggered&quot;</span>);</span><br><span class="line">    assert.<span class="title function_">equal</span>(receipt.<span class="property">logs</span>[<span class="number">0</span>].<span class="property">event</span>, <span class="string">&quot;getPcEvent&quot;</span>, <span class="string">&quot;the getPc event type is correct&quot;</span>);</span><br><span class="line">    assert.<span class="title function_">equal</span>(receipt.<span class="property">logs</span>[<span class="number">0</span>].<span class="property">args</span>.<span class="property">_museumId</span>.<span class="title function_">toNumber</span>(), museumId, <span class="string">&quot;the museum id got is correct&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> passcardInstance.<span class="title function_">removePasscard</span>(museumId, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">receipt</span>) &#123;</span><br><span class="line">    assert.<span class="title function_">equal</span>(receipt.<span class="property">logs</span>.<span class="property">length</span>, <span class="number">1</span>, <span class="string">&quot;an remove event was triggered&quot;</span>);</span><br><span class="line">    assert.<span class="title function_">equal</span>(receipt.<span class="property">logs</span>[<span class="number">0</span>].<span class="property">event</span>, <span class="string">&quot;removePcEvent&quot;</span>, <span class="string">&quot;the remove event type is correct&quot;</span>);</span><br><span class="line">    assert.<span class="title function_">equal</span>(receipt.<span class="property">logs</span>[<span class="number">0</span>].<span class="property">args</span>.<span class="property">_museumId</span>.<span class="title function_">toNumber</span>(), museumId, <span class="string">&quot;the museum id removed is correct&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This test inspects the transaction receipt returned by the <code>getPasscard</code>&#x2F;<code>removePasscard</code> function to ensure that it has logs. These logs contain the event that was triggered. We check that the event is the correct type, and that it has the correct museum id.</p>
<p>Now let’s update the client-side application to listen for the “get passcard” and “remove passcard” events and fire a page refresh any time when they are triggered. We can do that with a <code>listenForEvents</code> function like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">App</span> = &#123;</span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">listenForEvents</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">App</span>.<span class="property">contracts</span>.<span class="property">Passcard</span>.<span class="title function_">deployed</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      <span class="comment">// listen for all events from latest block</span></span><br><span class="line">      instance.<span class="title function_">allEvents</span>(&#123;<span class="attr">fromBlock</span>:<span class="string">&#x27;latest&#x27;</span>&#125;)</span><br><span class="line">        .<span class="title function_">watch</span>(<span class="keyword">function</span>(<span class="params">error, event</span>) &#123;</span><br><span class="line">        <span class="comment">// Reload when the user got new pass card or the user deleted a pass card</span></span><br><span class="line">        <span class="title class_">App</span>.<span class="title function_">render</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, we can call this function inside <code>initContract</code> whenever we initialize the contract:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">App</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">initContract</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">getJSON</span>(<span class="string">&quot;Passcard.json&quot;</span>, <span class="keyword">function</span>(<span class="params">passcard</span>) &#123;</span><br><span class="line">      <span class="comment">// Instantiate a new truffle contract from the artifact</span></span><br><span class="line">      <span class="title class_">App</span>.<span class="property">contracts</span>.<span class="property">Passcard</span> = <span class="title class_">TruffleContract</span>(passcard);</span><br><span class="line">      <span class="comment">// Connect provider to interact with contract</span></span><br><span class="line">      <span class="title class_">App</span>.<span class="property">contracts</span>.<span class="property">Passcard</span>.<span class="title function_">setProvider</span>(<span class="title class_">App</span>.<span class="property">web3Provider</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*direct automatically after users&#x27; operations*/</span></span><br><span class="line">      <span class="title class_">App</span>.<span class="title function_">listenForEvents</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">App</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s run our tests first to check if all of them can pass:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">truffle <span class="built_in">test</span></span></span><br></pre></td></tr></table></figure>

<p>Then start our development server again from the command line:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm run dev</span></span><br></pre></td></tr></table></figure>

<p>Now, you can play with pass cards on your client-side application, and watch the transactions recorded in real time!  </p>
<p>Congratulations! 🎉 You have successfully built a full stack decentralized application on the Ethereum blockchain!</p>
<p><img data-src="/images/tut_img/img1.png"></p>
<p><img data-src="/images/tut_img/img2.png"></p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a target="_blank" rel="noopener" href="https://www.dappuniversity.com/articles/the-ultimate-ethereum-dapp-tutorial">The Ultimate Ethereum Dapp Tutorial</a></p>
<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Node</span> v12.<span class="number">18</span>.<span class="number">2</span>,  </span><br><span class="line"><span class="attribute">lite</span>-server v2.<span class="number">5</span>.<span class="number">4</span>,  </span><br><span class="line"><span class="attribute">Solidity</span> v0.<span class="number">5</span>.<span class="number">16</span>,  </span><br><span class="line"><span class="attribute">Web3</span> v1.<span class="number">2</span>.<span class="number">11</span>,  </span><br><span class="line"><span class="attribute">Truffle</span> v5.<span class="number">1</span>.<span class="number">10</span>,  </span><br><span class="line"><span class="attribute">Ganache</span> v2.<span class="number">4</span>.<span class="number">0</span>  </span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Blockchain/" rel="tag"># Blockchain</a>
              <a href="/tags/Solidity/" rel="tag"># Solidity</a>
              <a href="/tags/Ethereum/" rel="tag"># Ethereum</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
            </div>
            <div class="post-nav-item">
                <a href="/2020/03/28/Leetcode-in-Java/" rel="next" title="Categorized LeetCode Problems">
                  Categorized LeetCode Problems <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhqyvvn</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"zhqyvvn","repo":"zhqyvvn.github.io","client_id":"c28a59a6f171f3e27313","client_secret":"a31ffbb812ba7a28cd66045ae2a68e017e9d539f","admin_user":"zhqyvvn","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"ce201011c19f772eb96e5103b0b0f420"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
